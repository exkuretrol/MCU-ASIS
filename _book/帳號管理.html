<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>B 帳號管理 | MCU ASIS Ubuntu 系統安裝指南</title>
<meta name="author" content="Chiawei Chen">
<meta name="generator" content="bookdown 0.28 with bs4_book()">
<meta property="og:title" content="B 帳號管理 | MCU ASIS Ubuntu 系統安裝指南">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="B 帳號管理 | MCU ASIS Ubuntu 系統安裝指南">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Noto_Sans_TC-0.4.2/font.css" rel="stylesheet">
<link href="libs/Source_Code_Pro-0.4.2/font.css" rel="stylesheet">
<link href="libs/Noto_Serif_TC-0.4.2/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="bs4_style.css">
<meta name="description" content="帳號管理分為兩個部分，一個部分是系統的帳號管理，另一個部分是 MySQL 資料庫的帳號管理。  B.1 系統帳號 這個小節會說明用來管理帳號的腳本的運作流程的活動圖、腳本運行，接著才是指令說明。如果要直接執行腳本請到 腳本運行 的部分。  B.1.1 概述 本腳本（Bash Script）的活動圖，如圖 B.1...">
<meta property="og:description" content="帳號管理分為兩個部分，一個部分是系統的帳號管理，另一個部分是 MySQL 資料庫的帳號管理。  B.1 系統帳號 這個小節會說明用來管理帳號的腳本的運作流程的活動圖、腳本運行，接著才是指令說明。如果要直接執行腳本請到 腳本運行 的部分。  B.1.1 概述 本腳本（Bash Script）的活動圖，如圖 B.1...">
<meta name="twitter:description" content="帳號管理分為兩個部分，一個部分是系統的帳號管理，另一個部分是 MySQL 資料庫的帳號管理。  B.1 系統帳號 這個小節會說明用來管理帳號的腳本的運作流程的活動圖、腳本運行，接著才是指令說明。如果要直接執行腳本請到 腳本運行 的部分。  B.1.1 概述 本腳本（Bash Script）的活動圖，如圖 B.1...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">MCU ASIS Ubuntu 系統安裝指南</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">引言</a></li>
<li class="book-part">基礎建設</li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> 虛擬主機</a></li>
<li><a class="" href="ubuntu-basic-configuration.html"><span class="header-section-number">2</span> Ubuntu 的基本設定</a></li>
<li class="book-part">軟體安裝</li>
<li><a class="" href="lamp-%E7%A8%8B%E5%BC%8F%E9%9B%86.html"><span class="header-section-number">3</span> LAMP 程式集</a></li>
<li><a class="" href="rstudio-rshiny-server.html"><span class="header-section-number">4</span> RStudio &amp; RShiny Server</a></li>
<li><a class="" href="jupyterlab-on-jupyterhub.html"><span class="header-section-number">5</span> JupyterLab on JupyterHub</a></li>
<li class="book-part">附錄</li>
<li><a class="" href="%E7%9B%B8%E9%97%9C%E8%BB%9F%E9%AB%94.html"><span class="header-section-number">A</span> 相關軟體</a></li>
<li><a class="active" href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html"><span class="header-section-number">B</span> 帳號管理</a></li>
<li><a class="" href="%E5%85%B6%E4%BB%96.html"><span class="header-section-number">C</span> 其他</a></li>
<li><a class="" href="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99.html">參考資料</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/exkuretrol/MCU-ASIS">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="帳號管理" class="section level1" number="7">
<h1>
<span class="header-section-number">B</span> 帳號管理<a class="anchor" aria-label="anchor" href="#%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86"><i class="fas fa-link"></i></a>
</h1>
<p>帳號管理分為兩個部分，一個部分是系統的帳號管理，另一個部分是 MySQL 資料庫的帳號管理。</p>
<div id="系統帳號" class="section level2" number="7.1">
<h2>
<span class="header-section-number">B.1</span> 系統帳號<a class="anchor" aria-label="anchor" href="#%E7%B3%BB%E7%B5%B1%E5%B8%B3%E8%99%9F"><i class="fas fa-link"></i></a>
</h2>
<p>這個小節會說明用來管理帳號的腳本的運作流程的活動圖、腳本運行，接著才是指令說明。如果要直接執行腳本請到 <a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#%E8%85%B3%E6%9C%AC%E9%81%8B%E8%A1%8C">腳本運行</a> 的部分。</p>
<div id="概述-4" class="section level3" number="7.1.1">
<h3>
<span class="header-section-number">B.1.1</span> 概述<a class="anchor" aria-label="anchor" href="#%E6%A6%82%E8%BF%B0-4"><i class="fas fa-link"></i></a>
</h3>
<p>本腳本（Bash Script）的活動圖，如圖 <a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#fig:manage-users-sh">B.1</a> 所示。一開始會根據使用者設定的選項的設定環境，接著才會進到主要方法的部分。主要方法有兩種，分別是建立帳號（<code>create</code>）與刪除帳號（<code>delete</code>），這兩個方法隨後會另外說明。</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:manage-users-sh"></span>
<img src="figures/manage-users.sh.svg" alt="manage-users.sh" width="40%"><p class="caption">
圖 B.1: manage-users.sh
</p>
</div>
</div>
<div id="腳本運行" class="section level3" number="7.1.2">
<h3>
<span class="header-section-number">B.1.2</span> 腳本運行<a class="anchor" aria-label="anchor" href="#%E8%85%B3%E6%9C%AC%E9%81%8B%E8%A1%8C"><i class="fas fa-link"></i></a>
</h3>
<p>這個部分會說明怎麼執行腳本。</p>
<p>首先先切換使用者目錄到家目錄底下的 <code>~/bin</code></p>
<div class="sourceCode" id="cb284"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb284-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/bin</span></code></pre></div>
<p>再來用你喜愛的編輯器在這個目錄底下新增一個叫做 <code>manage-users.sh</code> 的腳本（Bash Script）</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb285-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vim</span> manage-users.sh</span></code></pre></div>
<p>將藏在 ▶ 裡面的腳本內容放到腳本內後儲存</p>
<details><summary>
    管理使用者的腳本
  </summary><p>
</p>
<div class="code-label">
<p>~/bin/manage-users.sh</p>
</div>
<div class="sourceCode" id="cb286"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb286-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb286-2"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="co"># author: kuaz</span></span>
<span id="cb286-3"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-3" aria-hidden="true" tabindex="-1"></a><span class="co"># created date: 2022.02.24</span></span>
<span id="cb286-4"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-4" aria-hidden="true" tabindex="-1"></a><span class="co"># last modified: 2022.07.11</span></span>
<span id="cb286-5"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb286-6"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-6" aria-hidden="true" tabindex="-1"></a><span class="co"># This script is used to:</span></span>
<span id="cb286-7"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Create user accounts from /depts/dept.txt files (one student ID per line).</span></span>
<span id="cb286-8"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-9"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 環境變數</span></span>
<span id="cb286-10"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-10" aria-hidden="true" tabindex="-1"></a><span class="va">depts_dir</span><span class="op">=</span><span class="st">'depts'</span>       <span class="co"># 放置用來建置 linux 帳號的系資料夾</span></span>
<span id="cb286-11"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-11" aria-hidden="true" tabindex="-1"></a><span class="co"># pass_dir='passwd'       # 放置建置完成的 linux 帳號密碼的資料夾</span></span>
<span id="cb286-12"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-12" aria-hidden="true" tabindex="-1"></a><span class="va">gp</span><span class="op">=</span>false                <span class="co"># 是否產生新密碼</span></span>
<span id="cb286-13"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-13" aria-hidden="true" tabindex="-1"></a><span class="va">new</span><span class="op">=</span>true                <span class="co"># 是否是新版的 shiny app 連結方式；如果設為 true，</span></span>
<span id="cb286-14"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-14" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># 將不會使用 systemetic link 的方式連結</span></span>
<span id="cb286-15"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-15" aria-hidden="true" tabindex="-1"></a><span class="va">dryrun</span><span class="op">=</span>false            <span class="co"># 試運行；如果設為 true，將不會創立帳號</span></span>
<span id="cb286-16"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-16" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># useradd 是否支援 badname</span></span>
<span id="cb286-17"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-17" aria-hidden="true" tabindex="-1"></a><span class="va">badname_supported</span><span class="op">=</span><span class="va">$(</span><span class="ex">useradd</span> <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-q</span> <span class="st">"badname"</span><span class="kw">;</span> <span class="bu">echo</span> <span class="va">$?)</span>    </span>
<span id="cb286-18"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-19"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-19" aria-hidden="true" tabindex="-1"></a><span class="fu">check_permission()</span> <span class="kw">{</span></span>
<span id="cb286-20"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="va">${dryrun}</span> <span class="ot">==</span> true <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-21"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">:</span></span>
<span id="cb286-22"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb286-23"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="va">$(</span><span class="fu">id</span> <span class="at">-u</span><span class="va">)</span> <span class="ot">-ne</span> 0 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-24"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">echo</span> <span class="st">"必須以 root 權限執行此腳本！"</span><span class="kw">;</span></span>
<span id="cb286-25"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">exit</span> 1<span class="kw">;</span></span>
<span id="cb286-26"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb286-27"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb286-28"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-28" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb286-29"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-30"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-30" aria-hidden="true" tabindex="-1"></a><span class="fu">user_exists()</span> <span class="kw">{</span> </span>
<span id="cb286-31"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">id</span> <span class="st">"</span><span class="va">$1</span><span class="st">"</span> <span class="op">&amp;&gt;</span> /dev/null </span>
<span id="cb286-32"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-32" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb286-33"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-34"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-34" aria-hidden="true" tabindex="-1"></a><span class="fu">check_depts_dir()</span> <span class="kw">{</span></span>
<span id="cb286-35"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-d</span> <span class="va">${depts_dir}</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-36"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">grps</span><span class="op">=</span><span class="st">"</span><span class="va">$(</span><span class="fu">ls</span> ./<span class="va">${depts_dir}</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">".txt"</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-d</span> <span class="st">"."</span> <span class="at">-f</span> 1<span class="va">)</span><span class="st">"</span></span>
<span id="cb286-37"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> grp <span class="kw">in</span> <span class="va">${grps}</span></span>
<span id="cb286-38"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span></span>
<span id="cb286-39"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># https://stackoverflow.com/questions/28038633/wc-l-is-not-counting-last-of-the-file-if-it-does-not-have-end-of-line-character</span></span>
<span id="cb286-40"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-40" aria-hidden="true" tabindex="-1"></a>            <span class="va">count</span><span class="op">=</span><span class="va">$(</span><span class="fu">awk</span> <span class="st">'END{print NR}'</span> ./<span class="va">${depts_dir}</span>/<span class="va">${grp}</span>.txt<span class="va">)</span></span>
<span id="cb286-41"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-41" aria-hidden="true" tabindex="-1"></a>            <span class="va">file</span><span class="op">=</span><span class="va">$(</span><span class="fu">realpath</span> ./<span class="va">${depts_dir}</span>/<span class="va">${grp}</span>.txt<span class="va">)</span></span>
<span id="cb286-42"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">[</span> <span class="va">$count</span> <span class="ot">-lt</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-43"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-43" aria-hidden="true" tabindex="-1"></a>                <span class="bu">echo</span> <span class="st">"請再檢查一次 </span><span class="va">${depts_dir}</span><span class="st"> 內是否含有正確格式的學號檔案！"</span></span>
<span id="cb286-44"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-44" aria-hidden="true" tabindex="-1"></a>                <span class="bu">echo</span> <span class="st">"有問題的檔案: </span><span class="va">$file</span><span class="st">"</span></span>
<span id="cb286-45"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-45" aria-hidden="true" tabindex="-1"></a>                <span class="bu">exit</span> 1</span>
<span id="cb286-46"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span>
<span id="cb286-47"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-47" aria-hidden="true" tabindex="-1"></a>                <span class="bu">echo</span> <span class="st">"於 </span><span class="va">$file</span><span class="st"> 發現了 </span><span class="va">$count</span><span class="st"> 個學生"</span></span>
<span id="cb286-48"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">fi</span></span>
<span id="cb286-49"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">done</span></span>
<span id="cb286-50"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb286-51"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-51" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">"系資料夾 </span><span class="va">${depts_dir}</span><span class="st"> 不存在！請先手動創建或是由選項 -c, --generate-configuration 建立。"</span></span>
<span id="cb286-52"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-52" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exit</span> 1<span class="kw">;</span></span>
<span id="cb286-53"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb286-54"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-54" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb286-55"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-56"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-56" aria-hidden="true" tabindex="-1"></a><span class="co"># create_pass_dir() {</span></span>
<span id="cb286-57"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-57" aria-hidden="true" tabindex="-1"></a><span class="co">#     if [ ! -d ${pass_dir} ]; then</span></span>
<span id="cb286-58"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-58" aria-hidden="true" tabindex="-1"></a><span class="co">#         echo "存放密碼的 ${pass_dir} 資料夾不存在，將建立 ${pass_dir} 資料夾"</span></span>
<span id="cb286-59"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-59" aria-hidden="true" tabindex="-1"></a><span class="co">#         mkdir ${pass_dir}</span></span>
<span id="cb286-60"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-60" aria-hidden="true" tabindex="-1"></a><span class="co">#     else</span></span>
<span id="cb286-61"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-61" aria-hidden="true" tabindex="-1"></a><span class="co">#         read -p "存放密碼的 ${pass_dir} 資料夾已存在！是否要將其移除後繼續建立帳號? (yes/No)" yn</span></span>
<span id="cb286-62"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-62" aria-hidden="true" tabindex="-1"></a><span class="co">#         case $yn in</span></span>
<span id="cb286-63"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-63" aria-hidden="true" tabindex="-1"></a><span class="co">#             [Yy]* ) </span></span>
<span id="cb286-64"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-64" aria-hidden="true" tabindex="-1"></a><span class="co">#                 rm -rf ${pass_dir}</span></span>
<span id="cb286-65"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-65" aria-hidden="true" tabindex="-1"></a><span class="co">#                 make_pass_dir</span></span>
<span id="cb286-66"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-66" aria-hidden="true" tabindex="-1"></a><span class="co">#             ;;</span></span>
<span id="cb286-67"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-67" aria-hidden="true" tabindex="-1"></a><span class="co">#             [Nn]* ) exit 1;;</span></span>
<span id="cb286-68"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-68" aria-hidden="true" tabindex="-1"></a><span class="co">#         esac</span></span>
<span id="cb286-69"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-69" aria-hidden="true" tabindex="-1"></a><span class="co">#     fi</span></span>
<span id="cb286-70"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-70" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb286-71"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-72"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-72" aria-hidden="true" tabindex="-1"></a><span class="fu">create_users()</span> <span class="kw">{</span></span>
<span id="cb286-73"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 如果有產生密碼的需求</span></span>
<span id="cb286-74"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if [ ${gp} = true ]; then</span></span>
<span id="cb286-75"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-75" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     create_pass_dir</span></span>
<span id="cb286-76"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fi</span></span>
<span id="cb286-77"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-78"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> grp <span class="kw">in</span> <span class="va">${grps}</span></span>
<span id="cb286-79"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span></span>
<span id="cb286-80"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-80" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 確認使用者群組是否存在，如果不存在將自動建立</span></span>
<span id="cb286-81"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">$(</span><span class="fu">grep</span> <span class="at">-q</span> <span class="st">"^</span><span class="va">${grp}</span><span class="st">:"</span> /etc/group<span class="va">)</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-82"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-82" aria-hidden="true" tabindex="-1"></a>            <span class="bu">:</span></span>
<span id="cb286-83"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb286-84"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-84" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 非試運行</span></span>
<span id="cb286-85"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">[</span> <span class="va">${dryrun}</span> <span class="ot">=</span> false <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-86"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-86" aria-hidden="true" tabindex="-1"></a>                <span class="ex">groupadd</span> <span class="va">${grp}</span></span>
<span id="cb286-87"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">fi</span></span>
<span id="cb286-88"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-88" aria-hidden="true" tabindex="-1"></a>            <span class="bu">echo</span> <span class="st">"已建立 </span><span class="va">${grp}</span><span class="st"> 使用者群組"</span></span>
<span id="cb286-89"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb286-90"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span></span>
<span id="cb286-91"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-92"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> grp <span class="kw">in</span> <span class="va">${grps}</span></span>
<span id="cb286-93"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span> </span>
<span id="cb286-94"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 使用舊方法連結 ShinyApps</span></span>
<span id="cb286-95"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="va">${new}</span> <span class="ot">=</span> false <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-d</span> /srv/shiny-server/<span class="va">${grp}</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-96"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-96" aria-hidden="true" tabindex="-1"></a>            <span class="bu">echo</span> <span class="st">"/srv/shiny-server/</span><span class="va">${grp}</span><span class="st"> 資料夾不存在，將建立群組資料夾"</span></span>
<span id="cb286-97"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-97" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 非試運行</span></span>
<span id="cb286-98"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-98" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">[</span> <span class="va">${dryrun}</span> <span class="ot">=</span> false <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-99"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-99" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mkdir</span> /srv/shiny-server/<span class="va">${grp}</span></span>
<span id="cb286-100"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">fi</span></span>
<span id="cb286-101"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb286-102"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-103"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-103" aria-hidden="true" tabindex="-1"></a>        <span class="va">created</span><span class="op">=</span>0</span>
<span id="cb286-104"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-104" aria-hidden="true" tabindex="-1"></a>        <span class="va">skip</span><span class="op">=</span>0</span>
<span id="cb286-105"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-106"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-106" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 逐行讀取學號</span></span>
<span id="cb286-107"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">IFS</span><span class="op">=</span> <span class="bu">read</span> <span class="at">-r</span> <span class="va">stu</span> <span class="kw">||</span> <span class="bu">[</span> <span class="ot">-n</span> <span class="st">"</span><span class="va">$stu</span><span class="st">"</span> <span class="bu">]</span><span class="kw">;</span></span>
<span id="cb286-108"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span></span>
<span id="cb286-109"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-109" aria-hidden="true" tabindex="-1"></a>            <span class="va">cur_user</span><span class="op">=</span><span class="va">${stu}</span></span>
<span id="cb286-110"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-111"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-111" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="ex">user_exists</span> <span class="st">"</span><span class="va">${cur_user}</span><span class="st">"</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-112"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-112" aria-hidden="true" tabindex="-1"></a>                <span class="kw">((</span> <span class="va">skip</span> <span class="op">+=</span> <span class="dv">1</span> <span class="kw">))</span></span>
<span id="cb286-113"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-113" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb286-114"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-114" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">[</span> <span class="va">${dryrun}</span> <span class="ot">=</span> false <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-115"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-115" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 如果不支援 badname</span></span>
<span id="cb286-116"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-116" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">[</span> <span class="va">${badname_supported}</span> <span class="ot">==</span> false <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-117"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-117" aria-hidden="true" tabindex="-1"></a>                    <span class="ex">useradd</span> <span class="at">-N</span> <span class="at">-g</span> stu <span class="at">-G</span> <span class="va">${grp}</span> <span class="at">-m</span> <span class="va">${cur_user}</span></span>
<span id="cb286-118"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-118" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span></span>
<span id="cb286-119"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-119" aria-hidden="true" tabindex="-1"></a>                    <span class="ex">useradd</span> <span class="at">--badnames</span> <span class="at">-N</span> <span class="at">-g</span> stu <span class="at">-G</span> <span class="va">${grp}</span> <span class="at">-m</span> <span class="va">${cur_user}</span></span>
<span id="cb286-120"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-120" aria-hidden="true" tabindex="-1"></a>                <span class="cf">fi</span></span>
<span id="cb286-121"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-122"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-122" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 產生隨機密碼</span></span>
<span id="cb286-123"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-123" aria-hidden="true" tabindex="-1"></a>                <span class="co"># if [ ${gp} = false ]; then</span></span>
<span id="cb286-124"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-124" aria-hidden="true" tabindex="-1"></a>                <span class="va">cur_user_password</span><span class="op">=</span><span class="va">${cur_user}</span></span>
<span id="cb286-125"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-125" aria-hidden="true" tabindex="-1"></a>                <span class="co"># else</span></span>
<span id="cb286-126"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-126" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     cur_user_password=$(openssl rand -base64 6)</span></span>
<span id="cb286-127"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-127" aria-hidden="true" tabindex="-1"></a>                <span class="co"># fi</span></span>
<span id="cb286-128"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-128" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb286-129"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-129" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 以 root 權限創立使用者帳號，並設定密碼</span></span>
<span id="cb286-130"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-130" aria-hidden="true" tabindex="-1"></a>                <span class="bu">echo</span> <span class="st">"</span><span class="va">${cur_user}</span><span class="st">:</span><span class="va">${cur_user_password}</span><span class="st">"</span> <span class="kw">|</span> <span class="ex">chpasswd</span></span>
<span id="cb286-131"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-132"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-132" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 將設定的帳號密碼儲存一份到資料夾中</span></span>
<span id="cb286-133"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-133" aria-hidden="true" tabindex="-1"></a>                <span class="co"># echo "${cur_user},${cur_user_password}"| tee -a ./${pass_dir}/${grp}.csv &gt; /dev/null 2&gt;&amp;1</span></span>
<span id="cb286-134"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-135"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-135" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 將 ShinyApp 軟連結至使用者資料夾</span></span>
<span id="cb286-136"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-136" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">[</span> <span class="va">${new}</span> <span class="ot">=</span> false <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-137"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-137" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 需要先在 /etc/skel/ 建立 ShinyApps 資料夾，才可成功連結</span></span>
<span id="cb286-138"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-138" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ln</span> <span class="at">-s</span> /home/<span class="va">${cur_user}</span>/ShinyApps /srv/shiny-server/<span class="va">${grp}</span>/<span class="va">${cur_user}</span></span>
<span id="cb286-139"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-139" aria-hidden="true" tabindex="-1"></a>                <span class="cf">fi</span></span>
<span id="cb286-140"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-141"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-141" aria-hidden="true" tabindex="-1"></a>                <span class="kw">((</span> <span class="va">created</span> <span class="op">+=</span> <span class="dv">1</span> <span class="kw">))</span></span>
<span id="cb286-142"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-142" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span>
<span id="cb286-143"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-143" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 如果為試運行模式</span></span>
<span id="cb286-144"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-144" aria-hidden="true" tabindex="-1"></a>                <span class="kw">((</span> <span class="va">created</span> <span class="op">+=</span> <span class="dv">1</span> <span class="kw">))</span></span>
<span id="cb286-145"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-145" aria-hidden="true" tabindex="-1"></a>            <span class="cf">fi</span></span>
<span id="cb286-146"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-147"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">done</span> <span class="op">&lt;</span> ./<span class="va">${depts_dir}</span>/<span class="va">${grp}</span>.txt</span>
<span id="cb286-148"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-149"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-149" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">"成功從群組 </span><span class="va">${grp}</span><span class="st"> 建立了 </span><span class="va">${created}</span><span class="st"> 個帳號，忽略了 </span><span class="va">${skip}</span><span class="st"> 個已存在帳號。"</span></span>
<span id="cb286-150"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span></span>
<span id="cb286-151"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-151" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb286-152"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-153"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-153" aria-hidden="true" tabindex="-1"></a><span class="fu">delete_users()</span> <span class="kw">{</span></span>
<span id="cb286-154"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-154" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> grp <span class="kw">in</span> <span class="va">${grps}</span></span>
<span id="cb286-155"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-155" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span> </span>
<span id="cb286-156"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-156" aria-hidden="true" tabindex="-1"></a>        <span class="va">skip</span><span class="op">=</span>0</span>
<span id="cb286-157"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-157" aria-hidden="true" tabindex="-1"></a>        <span class="va">deleted</span><span class="op">=</span>0</span>
<span id="cb286-158"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-158" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">IFS</span><span class="op">=</span> <span class="bu">read</span> <span class="at">-r</span> <span class="va">stu</span> <span class="kw">||</span> <span class="bu">[</span> <span class="ot">-n</span> <span class="st">"</span><span class="va">$stu</span><span class="st">"</span> <span class="bu">]</span><span class="kw">;</span></span>
<span id="cb286-159"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span></span>
<span id="cb286-160"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-160" aria-hidden="true" tabindex="-1"></a>            <span class="va">cur_user</span><span class="op">=</span><span class="va">${stu}</span></span>
<span id="cb286-161"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-161" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="ex">user_exists</span> <span class="st">"</span><span class="va">${cur_user}</span><span class="st">"</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-162"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-162" aria-hidden="true" tabindex="-1"></a>                <span class="ex">userdel</span> <span class="at">-r</span> <span class="va">${cur_user}</span> <span class="op">&gt;</span> /dev/null <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span></span>
<span id="cb286-163"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-163" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">[</span> <span class="va">${new}</span> <span class="ot">=</span> false <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-164"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-164" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">rm</span> <span class="at">-rf</span> /srv/shiny-server/<span class="va">${grp}</span>/<span class="va">${stu}</span></span>
<span id="cb286-165"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-165" aria-hidden="true" tabindex="-1"></a>                <span class="cf">fi</span></span>
<span id="cb286-166"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-166" aria-hidden="true" tabindex="-1"></a>                <span class="kw">((</span> <span class="va">deleted</span> <span class="op">+=</span> <span class="dv">1</span> <span class="kw">))</span></span>
<span id="cb286-167"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-167" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span>
<span id="cb286-168"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-168" aria-hidden="true" tabindex="-1"></a>                <span class="kw">((</span> <span class="va">skip</span> <span class="op">+=</span> <span class="dv">1</span> <span class="kw">))</span></span>
<span id="cb286-169"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-169" aria-hidden="true" tabindex="-1"></a>            <span class="cf">fi</span></span>
<span id="cb286-170"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">done</span> <span class="op">&lt;</span> ./<span class="va">${depts_dir}</span>/<span class="va">${grp}</span>.txt</span>
<span id="cb286-171"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-171" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">"成功從群組 </span><span class="va">${grp}</span><span class="st"> 移除了 </span><span class="va">${deleted}</span><span class="st"> 個帳號，其中共有 </span><span class="va">${skip}</span><span class="st"> 個帳號不存在。"</span></span>
<span id="cb286-172"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-172" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span></span>
<span id="cb286-173"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-173" aria-hidden="true" tabindex="-1"></a>    <span class="co"># read -p "使用者已移除，是否要順便移除存放密碼的資料夾 ${pass_dir}? (yes/No)" yn</span></span>
<span id="cb286-174"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-175"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-175" aria-hidden="true" tabindex="-1"></a>    <span class="co"># case $yn in</span></span>
<span id="cb286-176"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-176" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     [Yy]* ) </span></span>
<span id="cb286-177"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-177" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         rm -rf ${pass_dir}</span></span>
<span id="cb286-178"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-178" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     ;;</span></span>
<span id="cb286-179"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-179" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     [No]* ) exit 0;;</span></span>
<span id="cb286-180"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-180" aria-hidden="true" tabindex="-1"></a>    <span class="co"># esac</span></span>
<span id="cb286-181"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-181" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb286-182"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-183"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-183" aria-hidden="true" tabindex="-1"></a><span class="fu">create_prompt()</span> <span class="kw">{</span></span>
<span id="cb286-184"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-184" aria-hidden="true" tabindex="-1"></a>    <span class="bu">read</span> <span class="at">-p</span> <span class="st">"即將建立使用者帳戶，確認使用者資料是否無誤?（Yes/No）"</span> <span class="va">yn</span></span>
<span id="cb286-185"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-185" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> </span>
<span id="cb286-186"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-187"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-187" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="va">$yn</span> <span class="kw">in</span></span>
<span id="cb286-188"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-188" aria-hidden="true" tabindex="-1"></a>        <span class="ss">[Yy]</span><span class="pp">*</span> <span class="kw">)</span> <span class="ex">create_users</span><span class="cf">;;</span></span>
<span id="cb286-189"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-189" aria-hidden="true" tabindex="-1"></a>        <span class="ss">[Nn]</span><span class="pp">*</span> <span class="kw">)</span> <span class="bu">exit</span> 0<span class="cf">;;</span></span>
<span id="cb286-190"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-190" aria-hidden="true" tabindex="-1"></a>    <span class="cf">esac</span></span>
<span id="cb286-191"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-191" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb286-192"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-193"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-193" aria-hidden="true" tabindex="-1"></a><span class="fu">delete_prompt()</span> <span class="kw">{</span></span>
<span id="cb286-194"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-194" aria-hidden="true" tabindex="-1"></a>    <span class="bu">read</span> <span class="at">-p</span> <span class="st">"即將 '刪除' 使用者帳戶，於 /home/&lt;使用者&gt; 的資料將會消失，是否執行?（Yes/No）"</span> <span class="va">yn</span></span>
<span id="cb286-195"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-195" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="va">$yn</span> <span class="kw">in</span></span>
<span id="cb286-196"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-196" aria-hidden="true" tabindex="-1"></a>        <span class="ss">[Yy]</span><span class="pp">*</span> <span class="kw">)</span> <span class="ex">delete_users</span><span class="cf">;;</span></span>
<span id="cb286-197"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-197" aria-hidden="true" tabindex="-1"></a>        <span class="ss">[Nn]</span><span class="pp">*</span> <span class="kw">)</span> <span class="bu">exit</span> 0<span class="cf">;;</span></span>
<span id="cb286-198"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">esac</span></span>
<span id="cb286-199"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-199" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb286-200"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-201"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-201" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_configuration()</span> <span class="kw">{</span></span>
<span id="cb286-202"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-202" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-d</span> <span class="va">${depts_dir}</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb286-203"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-203" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">"資料夾已存在！請先刪除 </span><span class="va">${depts_dir}</span><span class="st"> 資料夾"</span></span>
<span id="cb286-204"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-204" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb286-205"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-205" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mkdir</span> <span class="va">${depts_dir}</span></span>
<span id="cb286-206"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-206" aria-hidden="true" tabindex="-1"></a>        <span class="fu">touch</span> <span class="va">${depts_dir}</span>/asis.txt</span>
<span id="cb286-207"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-207" aria-hidden="true" tabindex="-1"></a>        <span class="fu">touch</span> <span class="va">${depts_dir}</span>/eco.txt</span>
<span id="cb286-208"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-208" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> 08170875 <span class="op">&gt;</span> <span class="va">${depts_dir}</span>/asis.txt</span>
<span id="cb286-209"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-209" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> 08220855 <span class="op">&gt;</span> <span class="va">${depts_dir}</span>/eco.txt</span>
<span id="cb286-210"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-210" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">"設定檔案建立完成"</span></span>
<span id="cb286-211"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-211" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb286-212"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-212" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exit</span> 0<span class="kw">;</span></span>
<span id="cb286-213"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-213" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb286-214"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-215"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-215" aria-hidden="true" tabindex="-1"></a><span class="fu">display_help()</span> <span class="kw">{</span></span>
<span id="cb286-216"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-216" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span> <span class="op">&lt;&lt; EOF</span></span>
<span id="cb286-217"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-217" aria-hidden="true" tabindex="-1"></a><span class="st">使用方法: </span><span class="va">$0</span><span class="st"> [ 選項... ] &lt; create | delete &gt;</span></span>
<span id="cb286-218"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-219"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-219" aria-hidden="true" tabindex="-1"></a><span class="st">選項: </span></span>
<span id="cb286-220"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-220" aria-hidden="true" tabindex="-1"></a><span class="st">    -h, --help                      產生此說明文字</span></span>
<span id="cb286-221"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-221" aria-hidden="true" tabindex="-1"></a><span class="st">    -d, --dry-run                   試運行腳本，不實際執行</span></span>
<span id="cb286-222"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-222" aria-hidden="true" tabindex="-1"></a><span class="st">    -c, --generate-configuration    產生範例設定</span></span>
<span id="cb286-223"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-223" aria-hidden="true" tabindex="-1"></a><span class="st">    -o, --old-shiny-server          ShinyApps 將使用軟連結的方式連結（不推薦）</span></span>
<span id="cb286-224"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-224" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb286-225"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-225" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb286-226"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-227"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-227" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">:</span></span>
<span id="cb286-228"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-228" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb286-229"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-229" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">"</span><span class="va">$1</span><span class="st">"</span> <span class="kw">in</span></span>
<span id="cb286-230"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-230" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-h</span> <span class="kw">|</span> <span class="ss">--help</span><span class="kw">)</span></span>
<span id="cb286-231"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-231" aria-hidden="true" tabindex="-1"></a>            <span class="ex">display_help</span></span>
<span id="cb286-232"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-232" aria-hidden="true" tabindex="-1"></a>            <span class="bu">exit</span> 0</span>
<span id="cb286-233"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-233" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb286-234"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-234" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-d</span> <span class="kw">|</span> <span class="ss">--dry-run</span><span class="kw">)</span></span>
<span id="cb286-235"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-235" aria-hidden="true" tabindex="-1"></a>            <span class="va">dryrun</span><span class="op">=</span>true</span>
<span id="cb286-236"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-236" aria-hidden="true" tabindex="-1"></a>            <span class="bu">shift</span> 1</span>
<span id="cb286-237"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-237" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb286-238"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-238" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb286-239"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-239" aria-hidden="true" tabindex="-1"></a>        <span class="co"># -p | --generate-password)</span></span>
<span id="cb286-240"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-240" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     gp=true</span></span>
<span id="cb286-241"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-241" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     shift 1</span></span>
<span id="cb286-242"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-242" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     break</span></span>
<span id="cb286-243"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-243" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ;;</span></span>
<span id="cb286-244"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-244" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-c</span> <span class="kw">|</span> <span class="ss">--generate-configuration</span><span class="kw">)</span></span>
<span id="cb286-245"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-245" aria-hidden="true" tabindex="-1"></a>            <span class="ex">generate_configuration</span></span>
<span id="cb286-246"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-246" aria-hidden="true" tabindex="-1"></a>            <span class="bu">exit</span> 0</span>
<span id="cb286-247"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-247" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb286-248"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-248" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-o</span> <span class="kw">|</span> <span class="ss">--old-shiny-server</span><span class="kw">)</span></span>
<span id="cb286-249"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-249" aria-hidden="true" tabindex="-1"></a>            <span class="va">new</span><span class="op">=</span>false</span>
<span id="cb286-250"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-250" aria-hidden="true" tabindex="-1"></a>            <span class="bu">shift</span> 1</span>
<span id="cb286-251"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-251" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb286-252"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-252" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb286-253"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-253" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-</span><span class="pp">*</span><span class="kw">)</span></span>
<span id="cb286-254"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-254" aria-hidden="true" tabindex="-1"></a>            <span class="bu">echo</span> <span class="st">"錯誤：未知的選項：</span><span class="va">$1</span><span class="st">"</span></span>
<span id="cb286-255"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-255" aria-hidden="true" tabindex="-1"></a>            <span class="ex">display_help</span></span>
<span id="cb286-256"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-256" aria-hidden="true" tabindex="-1"></a>            <span class="bu">exit</span> 1</span>
<span id="cb286-257"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-257" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb286-258"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-258" aria-hidden="true" tabindex="-1"></a>        <span class="pp">*</span><span class="kw">)</span></span>
<span id="cb286-259"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-259" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb286-260"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-260" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb286-261"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-261" aria-hidden="true" tabindex="-1"></a>    <span class="cf">esac</span></span>
<span id="cb286-262"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-262" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb286-263"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-264"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-264" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="st">"</span><span class="va">$1</span><span class="st">"</span> <span class="kw">in</span></span>
<span id="cb286-265"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-265" aria-hidden="true" tabindex="-1"></a>    <span class="ss">create</span><span class="kw">)</span></span>
<span id="cb286-266"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-266" aria-hidden="true" tabindex="-1"></a>        <span class="ex">check_permission</span></span>
<span id="cb286-267"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-267" aria-hidden="true" tabindex="-1"></a>        <span class="ex">check_depts_dir</span></span>
<span id="cb286-268"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-268" aria-hidden="true" tabindex="-1"></a>        <span class="ex">create_prompt</span></span>
<span id="cb286-269"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-269" aria-hidden="true" tabindex="-1"></a>    <span class="cf">;;</span></span>
<span id="cb286-270"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-270" aria-hidden="true" tabindex="-1"></a>    <span class="ss">delete</span><span class="kw">)</span></span>
<span id="cb286-271"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-271" aria-hidden="true" tabindex="-1"></a>        <span class="ex">check_permission</span></span>
<span id="cb286-272"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-272" aria-hidden="true" tabindex="-1"></a>        <span class="ex">check_depts_dir</span></span>
<span id="cb286-273"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-273" aria-hidden="true" tabindex="-1"></a>        <span class="ex">delete_prompt</span></span>
<span id="cb286-274"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-274" aria-hidden="true" tabindex="-1"></a>    <span class="cf">;;</span></span>
<span id="cb286-275"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-275" aria-hidden="true" tabindex="-1"></a>    <span class="pp">*</span><span class="kw">)</span></span>
<span id="cb286-276"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-276" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">"錯誤，請參考下列指令說明："</span></span>
<span id="cb286-277"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-277" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> </span>
<span id="cb286-278"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-278" aria-hidden="true" tabindex="-1"></a>        <span class="ex">display_help</span></span>
<span id="cb286-279"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-279" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exit</span> 1</span>
<span id="cb286-280"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-280" aria-hidden="true" tabindex="-1"></a>    <span class="cf">;;</span></span>
<span id="cb286-281"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb286-281" aria-hidden="true" tabindex="-1"></a><span class="cf">esac</span></span></code></pre></div>
  
</details><p>接著使用 <code>chmod</code> 指令為腳本加上可執行的權限</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb287-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x manage-users.sh</span></code></pre></div>
<p>使用腳本名稱加上 <code>-h</code> 或是 <code>--help</code> 選項可以顯示使用腳本的說明哦～</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb288-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./manage-users.sh</span> <span class="at">--help</span></span></code></pre></div>
<pre class="console_output"><code>使用方法: ./manage-users.sh [選項...] &lt;create | delete&gt;

選項:
    -h, --help                      產生此說明文字
    -d, --dry-run                   試運行腳本，不實際執行
    -c, --generate-configuration    產生範例設定
    -o, --old-shiny-server          ShinyApps 將使用軟連結的方式連結（不推薦）</code></pre>
<p>如果是第一次使用此腳本，可以使用 <code>-c</code> 選項產生範例設定</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb290-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./manage-users.sh</span> <span class="at">-c</span></span></code></pre></div>
<pre class="console.output"><code>├── depts
│   ├── asis.txt
│   └── eco.txt
└── manage-users.sh</code></pre>
<p>這個腳本會根據所設定的系資料夾新增帳號，新增的使用者帳號的主要使用者群組是 <code>stu</code>，副使用者群組為 <code>.txt</code> 的名稱，這一點要多加注意。</p>
<p>預設腳本產生的資料有兩個帳號，分別是屬於使用者群組 <code>asis</code> 的 <code>08170875</code> 與屬於使用者群組 <code>eco</code> 的 <code>08220855</code>。</p>
<p>接著使用 <code>sudo</code> 權限建立使用者帳號</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb292-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ./manage-users.sh create</span></code></pre></div>
<pre class="console_output"><code>於 /home/kuaz/Downloads/depts/asis.txt 發現了 1 個學生
於 /home/kuaz/Downloads/depts/eco.txt 發現了 1 個學生
即將建立使用者帳戶，確認使用者資料是否無誤?（Yes/No）</code></pre>
<p>這時候會預覽在檔案中發現的使用者數目，此時輸入 Yes/No 可以繼續或是中斷腳本，這裡選擇繼續所以輸入 <code>Y</code> 後按 Enter↩︎。</p>
<p>完成後也會提示建立帳號的說明</p>
<pre class="console_output"><code>成功從群組 asis 建立了 1 個帳號，忽略了 0 個已存在帳號。
成功從群組 eco 建立了 1 個帳號，忽略了 0 個已存在帳號。</code></pre>
<p>完成後可以用指令 <code>id</code> 確認使用者有無成功建立</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb295-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">id</span> 08170875<span class="kw">;</span> <span class="fu">id</span> 08220855</span></code></pre></div>
<pre class="console_output"><code>uid=1026(08170875) gid=1006(stu) groups=1006(stu),1007(asis)
uid=1027(08220855) gid=1006(stu) groups=1006(stu),1005(eco)</code></pre>
<p>測試完後可以用腳本附帶的 <code>detele</code> 方法刪除帳號</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb297-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ./manage-users.sh delete</span></code></pre></div>
<p>與建立帳號相同，刪除帳號一樣會有提示，這裡也是輸入 <code>Y</code> 後繼續刪除帳號的方法</p>
<pre class="console_output"><code>於 /home/kuaz/Downloads/depts/asis.txt 發現了 1 個學生
於 /home/kuaz/Downloads/depts/eco.txt 發現了 1 個學生
即將 '刪除' 使用者帳戶，於 /home/&lt;使用者&gt; 的資料將會消失，是否執行?（Yes/No）</code></pre>
<pre class="console_output"><code>成功從群組 asis 移除了 1 個帳號，其中共有 0 個帳號不存在。
成功從群組 eco 移除了 1 個帳號，其中共有 0 個帳號不存在。</code></pre>
<p>再用相同的指令確認使用者是否存在</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb300-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">id</span> 08170875<span class="kw">;</span> <span class="fu">id</span> 08220855</span></code></pre></div>
<p>提示使用者不存在</p>
<pre class="console_output"><code>id: ‘08170875’: no such user
id: ‘08220855’: no such user</code></pre>
</div>
<div id="指令說明" class="section level3" number="7.1.3">
<h3>
<span class="header-section-number">B.1.3</span> 指令說明<a class="anchor" aria-label="anchor" href="#%E6%8C%87%E4%BB%A4%E8%AA%AA%E6%98%8E"><i class="fas fa-link"></i></a>
</h3>
<div id="讀取選項的迴圈" class="section level4" number="7.1.3.1">
<h4>
<span class="header-section-number">B.1.3.1</span> 讀取選項的迴圈<a class="anchor" aria-label="anchor" href="#%E8%AE%80%E5%8F%96%E9%81%B8%E9%A0%85%E7%9A%84%E8%BF%B4%E5%9C%88"><i class="fas fa-link"></i></a>
</h4>
<p>首先是第一個迴圈，第一個迴圈是檢查選項用的，這裡使用的是 Bash Script 的 Case 語法（類似 Switch 的概念）。</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb302-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">:</span></span>
<span id="cb302-2"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb302-3"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">"</span><span class="va">$1</span><span class="st">"</span> <span class="kw">in</span></span>
<span id="cb302-4"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-4" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-h</span> <span class="kw">|</span> <span class="ss">--help</span><span class="kw">)</span></span>
<span id="cb302-5"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-5" aria-hidden="true" tabindex="-1"></a>            <span class="ex">display_help</span></span>
<span id="cb302-6"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-6" aria-hidden="true" tabindex="-1"></a>            <span class="bu">exit</span> 0</span>
<span id="cb302-7"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb302-8"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-8" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-d</span> <span class="kw">|</span> <span class="ss">--dry-run</span><span class="kw">)</span></span>
<span id="cb302-9"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-9" aria-hidden="true" tabindex="-1"></a>            <span class="va">dryrun</span><span class="op">=</span>true</span>
<span id="cb302-10"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-10" aria-hidden="true" tabindex="-1"></a>            <span class="bu">shift</span> 1</span>
<span id="cb302-11"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb302-12"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb302-13"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># -p | --generate-password)</span></span>
<span id="cb302-14"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     gp=true</span></span>
<span id="cb302-15"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     shift 1</span></span>
<span id="cb302-16"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     break</span></span>
<span id="cb302-17"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ;;</span></span>
<span id="cb302-18"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-18" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-c</span> <span class="kw">|</span> <span class="ss">--generate-configuration</span><span class="kw">)</span></span>
<span id="cb302-19"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-19" aria-hidden="true" tabindex="-1"></a>            <span class="ex">generate_configuration</span></span>
<span id="cb302-20"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-20" aria-hidden="true" tabindex="-1"></a>            <span class="bu">exit</span> 0</span>
<span id="cb302-21"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb302-22"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-22" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-o</span> <span class="kw">|</span> <span class="ss">--old-shiny-server</span><span class="kw">)</span></span>
<span id="cb302-23"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-23" aria-hidden="true" tabindex="-1"></a>            <span class="va">new</span><span class="op">=</span>false</span>
<span id="cb302-24"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">shift</span> 1</span>
<span id="cb302-25"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb302-26"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb302-27"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-27" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-</span><span class="pp">*</span><span class="kw">)</span></span>
<span id="cb302-28"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-28" aria-hidden="true" tabindex="-1"></a>            <span class="bu">echo</span> <span class="st">"錯誤：未知的選項：</span><span class="va">$1</span><span class="st">"</span></span>
<span id="cb302-29"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-29" aria-hidden="true" tabindex="-1"></a>            <span class="ex">display_help</span></span>
<span id="cb302-30"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-30" aria-hidden="true" tabindex="-1"></a>            <span class="bu">exit</span> 1</span>
<span id="cb302-31"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb302-32"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-32" aria-hidden="true" tabindex="-1"></a>        <span class="pp">*</span><span class="kw">)</span></span>
<span id="cb302-33"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb302-34"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb302-35"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">esac</span></span>
<span id="cb302-36"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb302-36" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<p>首先 <code>while :</code> 的意思在 Bash Script 裡面就是 <code>while true</code> 的意思。而 <strong>do-done</strong> 是接續 while 的語句。接著會碰到 <code>$1</code>，<code>$1</code> 代表的是指令以空白區隔，第一個位置的參數在 Bash Script 裡面就會被設為 <code>$1</code>，例如：</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb303-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./manage-users.sh</span> <span class="at">-c</span></span></code></pre></div>
<p>所以這裡的 <code>$1</code> 就代表著第一個參數位置，<code>-c</code>。所以當腳本碰到 <code>-</code> 開頭的選項時，就會落到 Case 的 Pattern 裡面去匹配選項。那為什麼腳本丟到 Case 裡面的變數一直都是 <code>$1</code> 也可以跑？是因為搭配了 <code>shift 1</code> 指令，當腳本碰到 <code>shift 1</code>，它會將 <code>$1</code> 丟棄，<code>$2</code> 遞補上來變為 <code>$1</code>，直到遇到其他終止的條件，像是 <code><a href="https://rdrr.io/r/base/Control.html">break</a></code> 或是 <code>exit</code>。</p>
</div>
<div id="讀取方法的-switch-case" class="section level4" number="7.1.3.2">
<h4>
<span class="header-section-number">B.1.3.2</span> 讀取方法的 Switch Case<a class="anchor" aria-label="anchor" href="#%E8%AE%80%E5%8F%96%E6%96%B9%E6%B3%95%E7%9A%84-switch-case"><i class="fas fa-link"></i></a>
</h4>
<p>一樣的，這裡會用到相同的 Switch Case 概念，假如上一個迴圈被 <code><a href="https://rdrr.io/r/base/Control.html">break</a></code> 終止後，且 <code>$1</code> 被包含在 Switch Case 的選項中就會觸發對應的方法。這裡我針對 <code>create</code> 與 <code>delete</code> 設定了不同的方法。</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb304-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="st">"</span><span class="va">$1</span><span class="st">"</span> <span class="kw">in</span></span>
<span id="cb304-2"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-2" aria-hidden="true" tabindex="-1"></a>    <span class="ss">create</span><span class="kw">)</span></span>
<span id="cb304-3"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-3" aria-hidden="true" tabindex="-1"></a>        <span class="ex">check_permission</span></span>
<span id="cb304-4"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-4" aria-hidden="true" tabindex="-1"></a>        <span class="ex">check_depts_dir</span></span>
<span id="cb304-5"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">create_prompt</span></span>
<span id="cb304-6"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">;;</span></span>
<span id="cb304-7"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-7" aria-hidden="true" tabindex="-1"></a>    <span class="ss">delete</span><span class="kw">)</span></span>
<span id="cb304-8"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">check_permission</span></span>
<span id="cb304-9"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">check_depts_dir</span></span>
<span id="cb304-10"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">delete_prompt</span></span>
<span id="cb304-11"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">;;</span></span>
<span id="cb304-12"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-12" aria-hidden="true" tabindex="-1"></a>    <span class="pp">*</span><span class="kw">)</span></span>
<span id="cb304-13"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">"錯誤，請參考下列指令說明："</span></span>
<span id="cb304-14"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> </span>
<span id="cb304-15"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-15" aria-hidden="true" tabindex="-1"></a>        <span class="ex">display_help</span></span>
<span id="cb304-16"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exit</span> 1</span>
<span id="cb304-17"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">;;</span></span>
<span id="cb304-18"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb304-18" aria-hidden="true" tabindex="-1"></a><span class="cf">esac</span></span></code></pre></div>
<p>建立使用者會依序呼叫 3 個方法，分別是 <code>check_permission</code>（檢查權限是否為 root）、<code>check_depts_dir</code>（檢查系資料夾是否符合規範）最後才是 <code>create_prompt</code> （建立使用者提示）。</p>
<!--# TODO: 這裡可以再增加範例 -->
</div>
<div id="建立使用者" class="section level4" number="7.1.3.3">
<h4>
<span class="header-section-number">B.1.3.3</span> 建立使用者<a class="anchor" aria-label="anchor" href="#%E5%BB%BA%E7%AB%8B%E4%BD%BF%E7%94%A8%E8%80%85"><i class="fas fa-link"></i></a>
</h4>
<p>建立使用者的流程如下圖，圖 <a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#fig:create-users">B.2</a> 活動圖所示：</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:create-users"></span>
<img src="figures/create-users.svg" alt="建立使用者" width="80%"><p class="caption">
圖 B.2: 建立使用者
</p>
</div>
<p>這裡用到非常多的 if 判斷環境，所以本腳本還有很多改善的空間。</p>
<div id="檢查權限check_permission方法" class="section level5" number="7.1.3.3.1">
<h5>
<span class="header-section-number">B.1.3.3.1</span> 檢查權限（<code>check_permission</code>）方法：<a class="anchor" aria-label="anchor" href="#%E6%AA%A2%E6%9F%A5%E6%AC%8A%E9%99%90check_permission%E6%96%B9%E6%B3%95"><i class="fas fa-link"></i></a>
</h5>
<div class="sourceCode" id="cb305"><pre class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb305-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb305-1"></a><span class="fu">check_permission()</span> <span class="kw">{</span></span>
<span id="cb305-2"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb305-2"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="va">${dryrun}</span> <span class="ot">==</span> true <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb305-3"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb305-3"></a>        <span class="bu">:</span></span>
<span id="cb305-4"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb305-4"></a>    <span class="cf">else</span></span>
<span id="cb305-5"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb305-5"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="va">$(</span><span class="fu">id</span> <span class="at">-u</span><span class="va">)</span> <span class="ot">-ne</span> 0 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb305-6"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb305-6"></a>            <span class="bu">echo</span> <span class="st">"必須以 root 權限執行此腳本！"</span><span class="kw">;</span></span>
<span id="cb305-7"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb305-7"></a>            <span class="bu">exit</span> 1<span class="kw">;</span></span>
<span id="cb305-8"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb305-8"></a>        <span class="cf">fi</span></span>
<span id="cb305-9"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb305-9"></a>    <span class="cf">fi</span></span>
<span id="cb305-10"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb305-10"></a><span class="kw">}</span></span></code></pre></div>
<p>這段程式碼做了：</p>
<ul>
<li><p>第 <strong>1</strong> 行，方法名稱</p></li>
<li><p>第 <strong>2</strong> 行，檢查變數 <code>dryrun</code>（試運行）是否為 <code>true</code>。如果試運行選項有設定時，會直接略過這個 <strong>if</strong> 語句。</p></li>
<li><p>第 <strong>3</strong> 行，<code>:</code> 在腳本中代表的是 <code>true</code> 的別名，因為 if 與句不能為空，所以這裡放一個 <code>:</code>。詳細說明可以參考<a href="https://stackoverflow.com/questions/3224878/what-is-the-purpose-of-the-colon-gnu-bash-builtin/3224910#3224910">這裡</a></p></li>
<li><p>第 <strong>5</strong> 行，檢查當前的使用者編號是否為 <code>0</code>，這裡的 <code>0</code> 是代表 <code>root</code>。</p></li>
<li><p>第 <strong>6</strong> 行，輸出訊息</p></li>
<li><p>第 <strong>7</strong> 行，結束程式，錯誤代碼為 <code>1</code></p></li>
</ul>
</div>
<div id="檢查系資料夾是否符合規範check_depts_dir" class="section level5" number="7.1.3.3.2">
<h5>
<span class="header-section-number">B.1.3.3.2</span> 檢查系資料夾是否符合規範（<code>check_depts_dir</code>）<a class="anchor" aria-label="anchor" href="#%E6%AA%A2%E6%9F%A5%E7%B3%BB%E8%B3%87%E6%96%99%E5%A4%BE%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88%E8%A6%8F%E7%AF%84check_depts_dir"><i class="fas fa-link"></i></a>
</h5>
<div class="sourceCode" id="cb306"><pre class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb306-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-1"></a><span class="fu">check_depts_dir()</span> <span class="kw">{</span></span>
<span id="cb306-2"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-2"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-d</span> <span class="va">${depts_dir}</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb306-3"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-3"></a>        <span class="va">grps</span><span class="op">=</span><span class="st">"</span><span class="va">$(</span><span class="fu">ls</span> ./<span class="va">${depts_dir}</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">".txt"</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-d</span> <span class="st">"."</span> <span class="at">-f</span> 1<span class="va">)</span><span class="st">"</span></span>
<span id="cb306-4"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-4"></a>        <span class="cf">for</span> grp <span class="kw">in</span> <span class="va">${grps}</span></span>
<span id="cb306-5"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-5"></a>        <span class="cf">do</span></span>
<span id="cb306-6"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-6"></a>            <span class="va">count</span><span class="op">=</span><span class="va">$(</span><span class="fu">awk</span> <span class="st">'END{print NR}'</span> ./<span class="va">${depts_dir}</span>/<span class="va">${grp}</span>.txt<span class="va">)</span></span>
<span id="cb306-7"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-7"></a>            <span class="va">file</span><span class="op">=</span><span class="va">$(</span><span class="fu">realpath</span> ./<span class="va">${depts_dir}</span>/<span class="va">${grp}</span>.txt<span class="va">)</span></span>
<span id="cb306-8"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-8"></a>            <span class="cf">if</span> <span class="bu">[</span> <span class="va">$count</span> <span class="ot">-lt</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb306-9"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-9"></a>                <span class="bu">echo</span> <span class="st">"請再檢查一次 </span><span class="va">${depts_dir}</span><span class="st"> 內是否含有正確格式的學號檔案！"</span></span>
<span id="cb306-10"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-10"></a>                <span class="bu">echo</span> <span class="st">"有問題的檔案: </span><span class="va">$file</span><span class="st">"</span></span>
<span id="cb306-11"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-11"></a>                <span class="bu">exit</span> 1</span>
<span id="cb306-12"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-12"></a>            <span class="cf">else</span></span>
<span id="cb306-13"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-13"></a>                <span class="bu">echo</span> <span class="st">"於 </span><span class="va">$file</span><span class="st"> 發現了 </span><span class="va">$count</span><span class="st"> 個學生"</span></span>
<span id="cb306-14"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-14"></a>            <span class="cf">fi</span></span>
<span id="cb306-15"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-15"></a>        <span class="cf">done</span></span>
<span id="cb306-16"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-16"></a>    <span class="cf">else</span></span>
<span id="cb306-17"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-17"></a>        <span class="bu">echo</span> <span class="st">"系資料夾 </span><span class="va">${depts_dir}</span><span class="st"> 不存在！請先手動創建或是由選項 -c, --generate-configuration 建立。"</span></span>
<span id="cb306-18"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-18"></a>        <span class="bu">exit</span> 1<span class="kw">;</span></span>
<span id="cb306-19"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-19"></a>    <span class="cf">fi</span></span>
<span id="cb306-20"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb306-20"></a><span class="kw">}</span></span></code></pre></div>
<p>這段程式碼做了：</p>
<ul>
<li><p>第 <strong>1</strong> 行，方法名稱</p></li>
<li><p>第 <strong>2</strong> 行，檢查資料夾 <code>depts</code> 是否存在</p></li>
<li><p>第 <strong>3</strong> 行，<code>ls</code> 會列出於 <code>depts</code> 資料夾中所有的檔案，<code>|</code> 會將前一個指令的結果傳到下一個指令裡面，<code>grep ".txt"</code> 會抓出含有 .txt 的檔案，接著最後的 <code>cut -d "." -f 1</code> 會將資料以 . 作為分隔符號切割，取出第一個結果。例如資料夾中有著三個 .txt 的檔案，<code>asis.txt</code>、<code>eco.txt</code>與 <code>fin.txt</code>，最後輸出的結果為：<code>asis</code>、<code>eco</code> 與 <code>fin</code>。</p></li>
<li><p>第 <strong>4-5</strong> 行，將前一個結果放到 For 迴圈中。</p></li>
<li><p>第 <strong>6</strong> 行，<code>awk</code> 是一種文字處理工具，這裡的功用是計算系資料中的檔案有幾列（不包含空行），估算要建立的使用者數目。</p></li>
<li><p>第 <strong>7</strong> 行，<code>realpath</code> 會將檔案完整的路進印出來，並儲存在變數 <code>file</code> 中</p></li>
<li><p>第 <strong>8</strong> 行，<strong>if</strong> 語句，如果數量少於 1</p></li>
<li><p>第 <strong>9-11</strong> 行，輸出訊息並中止</p></li>
<li><p>第 <strong>13</strong> 行，輸出訊息</p></li>
<li><p>第 <strong>17-18</strong> 行，輸出訊息並中止</p></li>
</ul>
</div>
<div id="建立使用者提示create_prompt" class="section level5" number="7.1.3.3.3">
<h5>
<span class="header-section-number">B.1.3.3.3</span> 建立使用者提示（<code>create_prompt</code>）<a class="anchor" aria-label="anchor" href="#%E5%BB%BA%E7%AB%8B%E4%BD%BF%E7%94%A8%E8%80%85%E6%8F%90%E7%A4%BAcreate_prompt"><i class="fas fa-link"></i></a>
</h5>
<div class="sourceCode" id="cb307"><pre class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb307-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb307-1"></a><span class="fu">create_prompt()</span> <span class="kw">{</span></span>
<span id="cb307-2"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb307-2"></a>    <span class="bu">read</span> <span class="at">-p</span> <span class="st">"即將建立使用者帳戶，確認使用者資料是否無誤?（Yes/No）"</span> <span class="va">yn</span></span>
<span id="cb307-3"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb307-3"></a>    <span class="bu">echo</span> </span>
<span id="cb307-4"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb307-4"></a></span>
<span id="cb307-5"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb307-5"></a>    <span class="cf">case</span> <span class="va">$yn</span> <span class="kw">in</span></span>
<span id="cb307-6"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb307-6"></a>        <span class="ss">[Yy]</span><span class="pp">*</span> <span class="kw">)</span> <span class="ex">create_users</span><span class="cf">;;</span></span>
<span id="cb307-7"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb307-7"></a>        <span class="ss">[Nn]</span><span class="pp">*</span> <span class="kw">)</span> <span class="bu">exit</span> 0<span class="cf">;;</span></span>
<span id="cb307-8"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb307-8"></a>    <span class="cf">esac</span></span>
<span id="cb307-9"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb307-9"></a><span class="kw">}</span></span></code></pre></div>
<p>這段程式碼做了：</p>
<ul>
<li><p>第 <strong>1</strong> 行，方法名稱</p></li>
<li><p>第 <strong>2</strong> 行，讀取使用者輸入，並儲存到變數 <code>yn</code> 中</p></li>
<li><p>第 <strong>5</strong> 行，Switch Case 語句</p></li>
<li><p>第 <strong>6</strong> 行，當第一個字母為 <code>Y</code> 或是 <code>y</code> 會落到此語句，並執行 <code>create_users</code> 方法</p></li>
<li><p>第 <strong>7</strong> 行，當第一個字母為 <code>N</code> 或是 <code>n</code> 會落到此語句，直接退出程式</p></li>
</ul>
</div>
<div id="建立使用者create_users" class="section level5" number="7.1.3.3.4">
<h5>
<span class="header-section-number">B.1.3.3.4</span> 建立使用者（<code>create_users</code>）<a class="anchor" aria-label="anchor" href="#%E5%BB%BA%E7%AB%8B%E4%BD%BF%E7%94%A8%E8%80%85create_users"><i class="fas fa-link"></i></a>
</h5>
<div class="sourceCode" id="cb308"><pre class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb308-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-1"></a><span class="fu">create_users()</span> <span class="kw">{</span></span>
<span id="cb308-2"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-2"></a>    <span class="co"># 如果有產生密碼的需求</span></span>
<span id="cb308-3"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-3"></a>    <span class="co"># if [ ${gp} = true ]; then</span></span>
<span id="cb308-4"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-4"></a>    <span class="co">#     create_pass_dir</span></span>
<span id="cb308-5"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-5"></a>    <span class="co"># fi</span></span>
<span id="cb308-6"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-6"></a></span>
<span id="cb308-7"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-7"></a>    <span class="cf">for</span> grp <span class="kw">in</span> <span class="va">${grps}</span></span>
<span id="cb308-8"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-8"></a>    <span class="cf">do</span></span>
<span id="cb308-9"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-9"></a>        <span class="co"># 確認使用者群組是否存在，如果不存在將自動建立</span></span>
<span id="cb308-10"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-10"></a>        <span class="cf">if</span> <span class="va">$(</span><span class="fu">grep</span> <span class="at">-q</span> <span class="st">"^</span><span class="va">${grp}</span><span class="st">:"</span> /etc/group<span class="va">)</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb308-11"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-11"></a>            <span class="bu">:</span></span>
<span id="cb308-12"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-12"></a>        <span class="cf">else</span></span>
<span id="cb308-13"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-13"></a>            <span class="co"># 非試運行</span></span>
<span id="cb308-14"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-14"></a>            <span class="cf">if</span> <span class="bu">[</span> <span class="va">${dryrun}</span> <span class="ot">=</span> false <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb308-15"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-15"></a>                <span class="ex">groupadd</span> <span class="va">${grp}</span></span>
<span id="cb308-16"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-16"></a>            <span class="cf">fi</span></span>
<span id="cb308-17"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-17"></a>            <span class="bu">echo</span> <span class="st">"已建立 </span><span class="va">${grp}</span><span class="st"> 使用者群組"</span></span>
<span id="cb308-18"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-18"></a>        <span class="cf">fi</span></span>
<span id="cb308-19"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-19"></a>    <span class="cf">done</span></span>
<span id="cb308-20"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-20"></a></span>
<span id="cb308-21"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-21"></a>    <span class="cf">for</span> grp <span class="kw">in</span> <span class="va">${grps}</span></span>
<span id="cb308-22"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-22"></a>    <span class="cf">do</span> </span>
<span id="cb308-23"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-23"></a>        <span class="co"># 使用舊方法連結 ShinyApps</span></span>
<span id="cb308-24"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-24"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="va">${new}</span> <span class="ot">=</span> false <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-d</span> /srv/shiny-server/<span class="va">${grp}</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb308-25"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-25"></a>            <span class="bu">echo</span> <span class="st">"/srv/shiny-server/</span><span class="va">${grp}</span><span class="st"> 資料夾不存在，將建立群組資料夾"</span></span>
<span id="cb308-26"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-26"></a>            <span class="co"># 非試運行</span></span>
<span id="cb308-27"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-27"></a>            <span class="cf">if</span> <span class="bu">[</span> <span class="va">${dryrun}</span> <span class="ot">=</span> false <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb308-28"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-28"></a>                <span class="fu">mkdir</span> /srv/shiny-server/<span class="va">${grp}</span></span>
<span id="cb308-29"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-29"></a>            <span class="cf">fi</span></span>
<span id="cb308-30"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-30"></a>        <span class="cf">fi</span></span>
<span id="cb308-31"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-31"></a></span>
<span id="cb308-32"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-32"></a>        <span class="va">created</span><span class="op">=</span>0</span>
<span id="cb308-33"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-33"></a>        <span class="va">skip</span><span class="op">=</span>0</span>
<span id="cb308-34"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-34"></a></span>
<span id="cb308-35"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-35"></a>        <span class="co"># 逐行讀取學號</span></span>
<span id="cb308-36"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-36"></a>        <span class="cf">while</span> <span class="va">IFS</span><span class="op">=</span> <span class="bu">read</span> <span class="at">-r</span> <span class="va">stu</span> <span class="kw">||</span> <span class="bu">[</span> <span class="ot">-n</span> <span class="st">"</span><span class="va">$stu</span><span class="st">"</span> <span class="bu">]</span><span class="kw">;</span></span>
<span id="cb308-37"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-37"></a>        <span class="cf">do</span></span>
<span id="cb308-38"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-38"></a>            <span class="va">cur_user</span><span class="op">=</span><span class="va">${stu}</span></span>
<span id="cb308-39"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-39"></a></span>
<span id="cb308-40"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-40"></a>            <span class="cf">if</span> <span class="ex">user_exists</span> <span class="st">"</span><span class="va">${cur_user}</span><span class="st">"</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb308-41"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-41"></a>                <span class="kw">((</span> <span class="va">skip</span> <span class="op">+=</span> <span class="dv">1</span> <span class="kw">))</span></span>
<span id="cb308-42"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-42"></a>            </span>
<span id="cb308-43"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-43"></a>            <span class="cf">elif</span> <span class="bu">[</span> <span class="va">${dryrun}</span> <span class="ot">=</span> false <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb308-44"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-44"></a>                <span class="co"># 如果不支援 badname</span></span>
<span id="cb308-45"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-45"></a>                <span class="cf">if</span> <span class="bu">[</span> <span class="va">${badname_supported}</span> <span class="ot">==</span> false <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb308-46"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-46"></a>                    <span class="ex">useradd</span> <span class="at">-N</span> <span class="at">-g</span> stu <span class="at">-G</span> <span class="va">${grp}</span> <span class="at">-m</span> <span class="va">${cur_user}</span></span>
<span id="cb308-47"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-47"></a>                <span class="cf">else</span></span>
<span id="cb308-48"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-48"></a>                    <span class="ex">useradd</span> <span class="at">--badnames</span> <span class="at">-N</span> <span class="at">-g</span> stu <span class="at">-G</span> <span class="va">${grp}</span> <span class="at">-m</span> <span class="va">${cur_user}</span></span>
<span id="cb308-49"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-49"></a>                <span class="cf">fi</span></span>
<span id="cb308-50"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-50"></a></span>
<span id="cb308-51"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-51"></a>                <span class="co"># 產生隨機密碼</span></span>
<span id="cb308-52"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-52"></a>                <span class="co"># if [ ${gp} = false ]; then</span></span>
<span id="cb308-53"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-53"></a>                <span class="va">cur_user_password</span><span class="op">=</span><span class="va">${cur_user}</span></span>
<span id="cb308-54"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-54"></a>                <span class="co"># else</span></span>
<span id="cb308-55"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-55"></a>                <span class="co">#     cur_user_password=$(openssl rand -base64 6)</span></span>
<span id="cb308-56"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-56"></a>                <span class="co"># fi</span></span>
<span id="cb308-57"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-57"></a>                </span>
<span id="cb308-58"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-58"></a>                <span class="co"># 以 root 權限創立使用者帳號，並設定密碼</span></span>
<span id="cb308-59"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-59"></a>                <span class="bu">echo</span> <span class="st">"</span><span class="va">${cur_user}</span><span class="st">:</span><span class="va">${cur_user_password}</span><span class="st">"</span> <span class="kw">|</span> <span class="ex">chpasswd</span></span>
<span id="cb308-60"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-60"></a></span>
<span id="cb308-61"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-61"></a>                <span class="co"># 將設定的帳號密碼儲存一份到資料夾中</span></span>
<span id="cb308-62"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-62"></a>                <span class="co"># echo "${cur_user},${cur_user_password}"| tee -a ./${pass_dir}/${grp}.csv &gt; /dev/null 2&gt;&amp;1</span></span>
<span id="cb308-63"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-63"></a></span>
<span id="cb308-64"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-64"></a>                <span class="co"># 將 ShinyApp 軟連結至使用者資料夾</span></span>
<span id="cb308-65"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-65"></a>                <span class="cf">if</span> <span class="bu">[</span> <span class="va">${new}</span> <span class="ot">=</span> false <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb308-66"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-66"></a>                    <span class="co"># 需要先在 /etc/skel/ 建立 ShinyApps 資料夾，才可成功連結</span></span>
<span id="cb308-67"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-67"></a>                    <span class="fu">ln</span> <span class="at">-s</span> /home/<span class="va">${cur_user}</span>/ShinyApps /srv/shiny-server/<span class="va">${grp}</span>/<span class="va">${cur_user}</span></span>
<span id="cb308-68"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-68"></a>                <span class="cf">fi</span></span>
<span id="cb308-69"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-69"></a></span>
<span id="cb308-70"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-70"></a>                <span class="kw">((</span> <span class="va">created</span> <span class="op">+=</span> <span class="dv">1</span> <span class="kw">))</span></span>
<span id="cb308-71"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-71"></a>            <span class="cf">else</span></span>
<span id="cb308-72"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-72"></a>                <span class="co"># 如果為試運行模式</span></span>
<span id="cb308-73"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-73"></a>                <span class="kw">((</span> <span class="va">created</span> <span class="op">+=</span> <span class="dv">1</span> <span class="kw">))</span></span>
<span id="cb308-74"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-74"></a>            <span class="cf">fi</span></span>
<span id="cb308-75"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-75"></a></span>
<span id="cb308-76"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-76"></a>        <span class="cf">done</span> <span class="op">&lt;</span> ./<span class="va">${depts_dir}</span>/<span class="va">${grp}</span>.txt</span>
<span id="cb308-77"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-77"></a></span>
<span id="cb308-78"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-78"></a>        <span class="bu">echo</span> <span class="st">"成功從群組 </span><span class="va">${grp}</span><span class="st"> 建立了 </span><span class="va">${created}</span><span class="st"> 個帳號，忽略了 </span><span class="va">${skip}</span><span class="st"> 個已存在帳號。"</span></span>
<span id="cb308-79"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-79"></a>    <span class="cf">done</span></span>
<span id="cb308-80"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb308-80"></a><span class="kw">}</span></span></code></pre></div>
<p>這段程式碼做了：</p>
<ul>
<li><p>第 <strong>1</strong> 行，方法名稱</p></li>
<li><p>第 <strong>7</strong> 行，根據 <code>check_depts_dir</code> 產生的變數 <code>grps</code> 做 <strong>For</strong> 迴圈</p></li>
<li><p>第 <strong>10</strong> 行，檢查當前 <strong>For</strong> 迴圈群組使否存在</p></li>
<li><p>第 <strong>11</strong> 行，<code>:</code> 在腳本中代表的是 <code>true</code> 的別名，因為 if 與句不能為空，所以這裡放一個 <code>:</code>。詳細說明可以參考<a href="https://stackoverflow.com/questions/3224878/what-is-the-purpose-of-the-colon-gnu-bash-builtin/3224910#3224910">這裡</a></p></li>
<li><p>第 <strong>14</strong> 行，檢查 <code>dryrun</code>（試運行）變數</p></li>
<li><p>第 <strong>15</strong> 行，新增使用者群組</p></li>
<li><p>第 <strong>21</strong> 行，根據 <code>check_depts_dir</code> 產生的變數 <code>grps</code> 做 <strong>For</strong> 迴圈</p></li>
<li><p>第 <strong>24</strong> 行，檢查 <code>new</code>（是否使用新方法創建 ShinyApps 資料夾）與 <code>/srv/shiny-server/群組名稱</code></p></li>
<li><p>第 <strong>25</strong> 行，輸出訊息</p></li>
<li><p>第 <strong>27</strong> 行，檢查 <code>dryrun</code>（試運行）變數</p></li>
<li><p>第 <strong>28</strong> 行，建立使用者群組</p></li>
<li><p>第 <strong>32-33</strong> 行，初始化變數，<code>created</code> 用來計算成功建立的使用者，<code>skip</code> 是用來計算已經存在的使用者。</p></li>
<li>
<p>第 <strong>36-37、76</strong> 行，逐行讀入指定的檔案，<code>&lt; ./${depts_dir}/${grp}.txt</code>，這裡會逐行讀入係檔案的學號，每行代表一個要建立的使用者，並儲存到 <code>stu</code> 變數中。</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb309-1"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">IFS</span><span class="op">=</span> <span class="bu">read</span> <span class="at">-r</span> <span class="va">stu</span> <span class="kw">||</span> <span class="bu">[</span> <span class="ot">-n</span> <span class="st">"</span><span class="va">$stu</span><span class="st">"</span> <span class="bu">]</span><span class="kw">;</span></span>
<span id="cb309-2"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb309-2" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb309-3"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb309-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">[</span> 省略... <span class="bu">]</span></span>
<span id="cb309-4"><a href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html#cb309-4" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&lt;</span> ./<span class="va">${depts_dir}</span>/<span class="va">${grp}</span>.txt</span></code></pre></div>
</li>
<li><p>第 <strong>38</strong> 行，複製一個 <code>stu</code> 變數儲存到 <code>cur_stu</code> 變數中</p></li>
<li><p>第 <strong>40</strong> 行，用方法 <code>user_exists</code> 判斷使用者是否存在，隨後的是方法是輸入變數</p></li>
<li><p>第 <strong>41</strong> 行，變數 <code>skip</code> 加 1</p></li>
<li><p>第 <strong>43</strong> 行，檢查 <code>dryrun</code>（試運行）變數</p></li>
<li><p>第 <strong>45</strong> 行，檢查 <code>badname_supported</code> 變數</p></li>
<li>
<p>第 <strong>46</strong> 行，使用 <code>useradd</code> 指令建立使用者，參數說明如下：</p>
<ul>
<li><p><code>-N, --no-user-group</code>：不建立使用者的個人使用者群組，須與 <code>-g</code> 同時使用</p></li>
<li><p><code>-g, --gid 群組</code>：指定使用者的主要群組</p></li>
<li><p><code>-G, --groups 群組1[, 群組2, ...[,群組N]]</code>：指定使用者的副群組</p></li>
<li><p><code>-m, --create-home</code>：建立使用者的家目錄</p></li>
</ul>
</li>
<li><p>第 <strong>48</strong> 行，多了 <code>--badnames</code> 選項，為了使不安全命名方式的使用者成功建立，例如數字開頭的使用者。</p></li>
<li><p>第 <strong>53</strong> 行，設定 <code>cur_user_password</code>（使用者密碼）變數為 <code>cur_user</code>（目前的使用者）變數</p></li>
<li><p>第 <strong>59</strong> 行，使用 <code>chpasswd</code> 變更 <code>cur_user</code>（目前的使用者）的使用者密碼</p></li>
<li><p>第 <strong>65</strong> 行，檢查 <code>new</code>（是否使用新方法創建 ShinyApps 資料夾）</p></li>
<li><p>第 <strong>67</strong> 行，將 ShinyApp 軟連結至使用者資料夾</p></li>
<li><p>第 <strong>70、73</strong> 行，變數 <code>created</code> 加 1</p></li>
<li><p>第 <strong>78</strong> 行，輸出訊息</p></li>
</ul>
<!-- ## 資料庫（MySQL）帳號 --><!-- ### 概述 --><!-- ``` bash --><!-- #!/bin/bash --><!-- # author: kuaz --><!-- # last modified: 2021.09.13 --><!-- #  --><!-- # 這個腳本被用來: --><!-- # 1. 根據已知的帳號密碼建立 MySQL 帳戶 --><!-- # 2. 根據帳號建立資料庫，編碼為 'utf8mb4' --><!-- # 3. 以上指令會儲存在當前資料夾的 create-account.sql 裡面 --><!-- # 4. 根據已知的帳號刪除該 MySQL 帳戶與資料庫 --><!-- # 5. 若加上 -r, --run 即可順便執行該腳本 --><!-- # 環境變數 --><!-- pass_dir='passwd'       # 放置密碼的資料夾，由另一個腳本 ./create-users.sh 產生 --><!-- filename='-accounts.sql'  # create/drop-accounts.sql 檔案前綴會根據選項變化 --><!-- run=false           # 預設產生腳本後不會執行 --><!-- check_pass_dir() { --><!--   if [ -d ${pass_dir} ]; then --><!--         grps="$(ls ${pass_dir} | grep ".csv" | cut -d "." -f 1)" --><!--   else --><!--         echo "密碼資料夾 ${pass_dir} 不存在！請先執行過建立帳號腳本（create-users.sh）後，再執行一次此腳本。" --><!--         exit 1; --><!--   fi --><!-- } --><!-- write_to_mysql_db() { --><!--   if [ ${run} = true ]; then --><!--         echo "請輸入 MySQL 帳戶 root 的密碼: 👇" --><!--         mysql -u root -p < ${filename} --><!--         clean_sql_script --><!--   else --><!--         echo "已於 $(pwd) 產生 ${filename} 🎉" --><!--   fi --><!-- } --><!-- create_users_and_databases() { --><!--   echo "set global validate_password.policy=LOW;" | tee -a ${filename} > /dev/null 2>&1; --><!--   for grp in ${grps} --><!--     do  --><!--         while read line; --><!--         do --><!--             stu="$(echo ${line} | cut -d ',' -f 1)" --><!--             pass="$(echo ${line} | cut -d ',' -f 2)" --><!--             echo "create user '${stu}'@'localhost' identified by '${pass}';" \ --><!--                 | tee -a ${filename} > /dev/null 2>&1 --><!--             echo "create database \`${stu}\` character set utf8mb4 collate utf8mb4_unicode_ci;" \ --><!--                 | tee -a ${filename} > /dev/null 2>&1 --><!--             echo "grant all privileges on \`${stu}\`.* to '${stu}'@'localhost';" \ --><!--                 | tee -a ${filename} > /dev/null 2>&1 --><!--         done < ${pass_dir}/${grp}.csv --><!--   done --><!--   echo "flush privileges;" | tee -a ${filename} > /dev/null 2>&1; --><!--   write_to_mysql_db --><!-- } --><!-- drop_users_and_databases() { --><!--   for grp in ${grps} --><!--     do  --><!--         while read line; --><!--         do --><!--             stu="$(echo ${line} | cut -d ',' -f 1)" --><!--             echo "drop user '${stu}'@'localhost';" \ --><!--                 | tee -a ${filename} > /dev/null 2>&1 --><!--             echo "drop database \`${stu}\`;" \ --><!--                 | tee -a ${filename} > /dev/null 2>&1 --><!--         done < ${pass_dir}/${grp}.csv --><!--   done --><!--   write_to_mysql_db --><!-- } --><!-- display_help() { --><!--   echo "這個腳本被用來:" --><!--   echo "1. 根據已知的帳號密碼建立 MySQL 帳戶" --><!--   echo "2. 根據帳號建立資料庫，編碼為 'utf8mb4'" --><!--   echo "3. 以上指令會儲存在當前資料夾的 create-account.sql 裡面" --><!--   echo "4. 根據已知的帳號刪除該 MySQL 帳戶與資料庫" --><!--   echo "5. 若加上 -r, --run 即可順便執行該腳本" --><!--   echo --><!--   echo "使用方法: $0 [option...] {create|drop}" --><!--   echo --><!--   echo "options: " --><!--   echo "  -r, --run  執行腳本" --><!--   echo "  -h, --help  顯示說明" --><!--   echo "  沒有加任何選項: 僅產生 .sql 腳本" --><!--   echo --><!--   exit 0 --><!-- } --><!-- clean_sql_script() { --><!--   read -p "是否要清除 ${filename}? (Yes/No)" yn --><!--   case $yn in --><!--         [Yy]* ) rm ${filename} ;; --><!--         [Nn]* ) exit 0;; --><!--   esac --><!--   echo "DONE 🎉" --><!-- } --><!-- while : --><!-- do --><!--   case "$1" in --><!--         -r | --run) --><!--             run=true --><!--             shift 1 --><!--             ;; --><!--         -h | --help) --><!--             display_help --><!--             exit 0 --><!--             ;; --><!--         --) --><!--             shift --><!--             break --><!--             ;; --><!--         -*) --><!--             echo "錯誤: 未知的選項: $1" >&2 --><!--             display_help --><!--             exit 1 --><!--             ;; --><!--         *) --><!--             break --><!--             ;; --><!--     esac --><!-- done --><!-- case "$1" in --><!--   create) --><!--         check_pass_dir --><!--         if [ $? -ne 1 ]; then --><!--             filename="$1$filename" --><!--             create_users_and_databases --><!--         fi --><!--         ;; --><!--     drop) --><!--         check_pass_dir --><!--         if [ $? -ne 1 ]; then --><!--             filename="$1$filename" --><!--             drop_users_and_databases --><!--         fi --><!--         ;; --><!--     *) --><!--         display_help --><!--         exit 0 --><!--         ;; --><!-- esac --><!-- ``` -->
</div>
</div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="%E7%9B%B8%E9%97%9C%E8%BB%9F%E9%AB%94.html"><span class="header-section-number">A</span> 相關軟體</a></div>
<div class="next"><a href="%E5%85%B6%E4%BB%96.html"><span class="header-section-number">C</span> 其他</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86"><span class="header-section-number">B</span> 帳號管理</a></li>
<li>
<a class="nav-link" href="#%E7%B3%BB%E7%B5%B1%E5%B8%B3%E8%99%9F"><span class="header-section-number">B.1</span> 系統帳號</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E6%A6%82%E8%BF%B0-4"><span class="header-section-number">B.1.1</span> 概述</a></li>
<li><a class="nav-link" href="#%E8%85%B3%E6%9C%AC%E9%81%8B%E8%A1%8C"><span class="header-section-number">B.1.2</span> 腳本運行</a></li>
<li><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E8%AA%AA%E6%98%8E"><span class="header-section-number">B.1.3</span> 指令說明</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/exkuretrol/MCU-ASIS/blob/main/98-appendix.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/exkuretrol/MCU-ASIS/edit/main/98-appendix.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>MCU ASIS Ubuntu 系統安裝指南</strong>" was written by Chiawei Chen. It was last built on 2023-08-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
