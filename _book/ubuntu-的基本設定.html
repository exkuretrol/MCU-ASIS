<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>章節 2 Ubuntu 的基本設定 | MCU ASIS Ubuntu 系統安裝指南</title>
<meta name="author" content="Chiawei Chen">
<meta name="generator" content="bookdown 0.28 with bs4_book()">
<meta property="og:title" content="章節 2 Ubuntu 的基本設定 | MCU ASIS Ubuntu 系統安裝指南">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="章節 2 Ubuntu 的基本設定 | MCU ASIS Ubuntu 系統安裝指南">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Noto_Sans_TC-0.4.2/font.css" rel="stylesheet">
<link href="libs/Source_Code_Pro-0.4.2/font.css" rel="stylesheet">
<link href="libs/Noto_Serif_TC-0.4.2/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="bs4_style.css">
<meta name="description" content="本章主要會說明如何透過遠端連線存取虛擬機器與虛擬機器基本設定。  2.1 事前準備 從這個章節開始會出現一些特殊前綴的方框（如下表）表示，不同的前綴代表不同種類的終端機，或是使用終端機的身份，請多多注意。 PS: powershell 指令前綴 dir  $: 終端機指令前綴（一般使用者） ls -al  #: 終端機指令前綴（超級使用者） sudo rm -rf ~/Downloads ...">
<meta property="og:description" content="本章主要會說明如何透過遠端連線存取虛擬機器與虛擬機器基本設定。  2.1 事前準備 從這個章節開始會出現一些特殊前綴的方框（如下表）表示，不同的前綴代表不同種類的終端機，或是使用終端機的身份，請多多注意。 PS: powershell 指令前綴 dir  $: 終端機指令前綴（一般使用者） ls -al  #: 終端機指令前綴（超級使用者） sudo rm -rf ~/Downloads ...">
<meta name="twitter:description" content="本章主要會說明如何透過遠端連線存取虛擬機器與虛擬機器基本設定。  2.1 事前準備 從這個章節開始會出現一些特殊前綴的方框（如下表）表示，不同的前綴代表不同種類的終端機，或是使用終端機的身份，請多多注意。 PS: powershell 指令前綴 dir  $: 終端機指令前綴（一般使用者） ls -al  #: 終端機指令前綴（超級使用者） sudo rm -rf ~/Downloads ...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">MCU ASIS Ubuntu 系統安裝指南</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">引言</a></li>
<li class="book-part">基礎建設</li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> 虛擬主機</a></li>
<li><a class="active" href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html"><span class="header-section-number">2</span> Ubuntu 的基本設定</a></li>
<li class="book-part">軟體安裝</li>
<li><a class="" href="lamp-%E7%A8%8B%E5%BC%8F%E9%9B%86.html"><span class="header-section-number">3</span> LAMP 程式集</a></li>
<li><a class="" href="rstudio-rshiny-server.html"><span class="header-section-number">4</span> RStudio &amp; RShiny Server</a></li>
<li><a class="" href="jupyterlab-on-jupyterhub.html"><span class="header-section-number">5</span> JupyterLab on JupyterHub</a></li>
<li class="book-part">附錄</li>
<li><a class="" href="%E7%9B%B8%E9%97%9C%E8%BB%9F%E9%AB%94.html"><span class="header-section-number">A</span> 相關軟體</a></li>
<li><a class="" href="%E5%B8%B3%E8%99%9F%E7%AE%A1%E7%90%86.html"><span class="header-section-number">B</span> 帳號管理</a></li>
<li><a class="" href="%E5%85%B6%E4%BB%96.html"><span class="header-section-number">C</span> 其他</a></li>
<li><a class="" href="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99.html">參考資料</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/exkuretrol/MCU-ASIS">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ubuntu-的基本設定" class="section level1" number="2">
<h1>
<span class="header-section-number">章節 2</span> Ubuntu 的基本設定<a class="anchor" aria-label="anchor" href="#ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A"><i class="fas fa-link"></i></a>
</h1>
<!--# TODO: https://superuser.com/questions/1200355/wsl-is-it-possible-to-access-and-manipulate-a-virtual-linux-machine-with-wsl -->
<p>本章主要會說明如何透過遠端連線存取虛擬機器與虛擬機器基本設定。</p>
<div id="事前準備-1" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> 事前準備<a class="anchor" aria-label="anchor" href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99-1"><i class="fas fa-link"></i></a>
</h2>
<p>從這個章節開始會出現一些特殊前綴的方框（如下表）表示，不同的前綴代表不同種類的終端機，或是使用終端機的身份，請多多注意。</p>
<ul>
<li>
<p><code>PS</code>: powershell 指令前綴</p>
<pre class="prefixed_powershell"><code>dir</code></pre>
</li>
<li>
<p><code>$</code>: 終端機指令前綴（一般使用者）</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb4-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-al</span></span></code></pre></div>
</li>
<li>
<p><code>#</code>: 終端機指令前綴（超級使用者）</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash prefixed_root"><code class="sourceCode bash"><span id="cb5-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> rm <span class="at">-rf</span> ~/Downloads</span></code></pre></div>
</li>
<li>
<p><code>OUTPUT</code>: 終端機輸出</p>
<pre class="console_output"><code>total 12
drwxrwxr-x  3 kuaz kuaz 4096 Sep 22 02:11 ./
drwxr-x--- 15 kuaz kuaz 4096 Oct 10 22:30 ../
drwxrwxr-x  6 kuaz kuaz 4096 Oct  6 14:06 School/</code></pre>
</li>
</ul>
</div>
<div id="openssh" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> OpenSSH<a class="anchor" aria-label="anchor" href="#openssh"><i class="fas fa-link"></i></a>
</h2>
<p>前面第一章在安裝時，也有碰到 OpenSSH 伺服器設定的小節，不過那並不完整，是給已經擁有 ssh key pairs 的使用者看的。在這個小節會逐步解釋 OpenSSH 的使用方法，從 OpenSSH 客戶端安裝、產生 ssh key pairs 最後到連線。</p>
<div id="概述" class="section level3" number="2.2.1">
<h3>
<span class="header-section-number">2.2.1</span> 概述<a class="anchor" aria-label="anchor" href="#%E6%A6%82%E8%BF%B0"><i class="fas fa-link"></i></a>
</h3>
<p>OpenSSH 是 SSH（Secure Shell）一個開源的版本。SSH 是一種透過 SSH 傳輸協定來管理系統、傳輸檔案的一個系統套件。它現在被廣泛的使用在各個資料中心與大企業中。</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-48"></span>
<img src="figures/SSH_simplified_protocol_diagram-2.png" alt="SSH 傳輸協定驗證流程 圖片來源：https://www.ssh.com/academy/ssh" width="80%"><p class="caption">
圖 2.1: SSH 傳輸協定驗證流程 圖片來源：<a href="https://www.ssh.com/academy/ssh" class="uri">https://www.ssh.com/academy/ssh</a>
</p>
</div>
</div>
<div id="適合各個系統的連線流程" class="section level3" number="2.2.2">
<h3>
<span class="header-section-number">2.2.2</span> 適合各個系統的連線流程<a class="anchor" aria-label="anchor" href="#%E9%81%A9%E5%90%88%E5%90%84%E5%80%8B%E7%B3%BB%E7%B5%B1%E7%9A%84%E9%80%A3%E7%B7%9A%E6%B5%81%E7%A8%8B"><i class="fas fa-link"></i></a>
</h3>
<p>要連接到虛擬機器的 OpenSSH 伺服器之前，你需要有一個可以讓你連接的 OpenSSH 用戶端。</p>
<div id="macos-或-其他-unix-like-系統" class="section level4" number="2.2.2.1">
<h4>
<span class="header-section-number">2.2.2.1</span> MacOS 或 其他 Unix-like 系統<a class="anchor" aria-label="anchor" href="#macos-%E6%88%96-%E5%85%B6%E4%BB%96-unix-like-%E7%B3%BB%E7%B5%B1"><i class="fas fa-link"></i></a>
</h4>
<p>如果你是 Linux 或是 MacOS 系統，通常都有內建 OpenSSH 用戶端，可以直接跳至以 <a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#step-2-%E7%94%A2%E7%94%9F-ssh-key-pairs">Step 2 — 產生 ssh key pairs</a> 的章節，但是 Windows 系統需要先安裝一些軟體，或是從 Windows 更新功能裡面啟用 OpenSSH 伺服器與用戶端，將於下一小節會解釋。</p>
</div>
<div id="windows-系統" class="section level4" number="2.2.2.2">
<h4>
<span class="header-section-number">2.2.2.2</span> Windows 系統<a class="anchor" aria-label="anchor" href="#windows-%E7%B3%BB%E7%B5%B1"><i class="fas fa-link"></i></a>
</h4>
<p>Windows 用戶連線至 OpenSSH 伺服器的方法有很多種，方法如下:</p>
<ol style="list-style-type: decimal">
<li>
<p>已經擁有 SSH key pairs 的前提下，可以使用 SSH 通訊協定連線的軟體，如:</p>
<ul>
<li><p>PuTTY</p></li>
<li><p>Chrome 瀏覽器的任何一個 SSH 擴充套件<br></p></li>
</ul>
<p><strong>優點:</strong></p>
<ul>
<li>很快，安裝完就能設定 SSH 連線</li>
</ul>
</li>
<li>
<p>直接在 Windows 10 內啟動 OpenSSH 用戶端，透過內建的 PowerShell SSH 連線至虛擬主機。<br><br><strong>優點:</strong></p>
<ul>
<li>與第一個方法差不多快</li>
<li>可搭配 Windows Terminal 客製化終端機主題（很好看）</li>
<li>不用安裝任何第三方軟體</li>
</ul>
</li>
<li>
<p>在 Windows 10 內安裝 Windows 子系統 (Windows Subsystem for Linux; WSL)，然後直接在 Linux 環境透過 OpenSSH 連線至虛擬主機。<br><br><strong>優點:</strong></p>
<ul>
<li>可以學習到很多東西， Linux 可以用的在 Windows 的 WSL 內都可以使用，操作可以照搬到 WSL 上面。</li>
</ul>
<p><strong>缺點:</strong></p>
<ul>
<li>安裝過程所需的時間會根據每個人的經驗有所差異，需要從頭開始設定 Linux。</li>
</ul>
</li>
</ol>
<p>在 Windows 要產生 ssh key pairs 有兩種辦法，第一種是經由內建的 OpenSSH Client 產生，另一種是經由 PuTTY 所附的工具產生（可以參考附錄的 <a href="%E7%9B%B8%E9%97%9C%E8%BB%9F%E9%AB%94.html#putty">PuTTY</a> 介紹）。</p>
<div class="infobox info">
<p>Linux 的使用者可以使用套件管理程式安裝 <code>openssh-server</code>， 指令如下：</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb7-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install openssh-server</span></code></pre></div>
</div>
</div>
</div>
<div id="step-1-安裝-openssh-client" class="section level3" number="2.2.3">
<h3>
<span class="header-section-number">2.2.3</span> Step 1 — 安裝 OpenSSH Client<a class="anchor" aria-label="anchor" href="#step-1-%E5%AE%89%E8%A3%9D-openssh-client"><i class="fas fa-link"></i></a>
</h3>
<p>Windows 10 已經有內建在 Windows 的「應用程式與功能」內，預設是沒有安裝的。啟動流程如下:</p>
<ul>
<li><p>點擊「開始」</p></li>
<li><p>打開「設定⚙」</p></li>
<li><p>選取「應用程式」 ➜ 「應用程式與功能」 ➜ 找到黑體字「程式與功能」，並點選下面的「選用功能」</p></li>
<li>
<p>在已安裝的篩選列上面篩選 <code>ssh</code> ，如果沒有，請在頁面頂端點選「新增功能」，然後:</p>
<ul>
<li>找到「OpenSSH 用戶端」後，點選安裝</li>
</ul>
</li>
</ul>
<p>安裝完成後，你可以打開「命令提示字元」或是「PowerShell」輸入 ssh 來確認是否安裝完成。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode powershell prefixed_powershell"><code class="sourceCode powershell"><span id="cb8-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb8-1" aria-hidden="true" tabindex="-1"></a>ssh</span></code></pre></div>
<pre class="console_output"><code>usage: ssh [-46AaCfGgKkMNnqsTtVvXxYy] [-B bind_interface]
           [-b bind_address] [-c cipher_spec] [-D [bind_address:]port]
           [-E log_file] [-e escape_char] [-F configfile] [-I pkcs11]
           [-i identity_file] [-J [user@]host[:port]] [-L address]
           [-l login_name] [-m mac_spec] [-O ctl_cmd] [-o option] [-p port]
           [-Q query_option] [-R address] [-S ctl_path] [-W host:port]
           [-w local_tun[:remote_tun]] destination [command]</code></pre>
</div>
<div id="step-2-產生-ssh-key-pairs" class="section level3" number="2.2.4">
<h3>
<span class="header-section-number">2.2.4</span> Step 2 — 產生 ssh key pairs<a class="anchor" aria-label="anchor" href="#step-2-%E7%94%A2%E7%94%9F-ssh-key-pairs"><i class="fas fa-link"></i></a>
</h3>
<p>接著，可以使用 <code>ssh-keygen</code> 指令產生 key pairs，加密方式有 dsa、ecdsa、ecdsa-sk、ed25519、ed25519-sk 與 rsa，預設的加密方式是 rsa ，詳細指令用法可以透過 <code>ssh-keygen --help</code> 指令查詢，這裡我們用最簡單的 <code>ssh-keygen</code> 指令。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode powershell prefixed_powershell"><code class="sourceCode powershell"><span id="cb10-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb10-1" aria-hidden="true" tabindex="-1"></a>ssh<span class="op">-</span>keygen</span></code></pre></div>
<p>Windows 的用戶預設會把 key pair 儲存在 <code>C:\Users\&lt;USERNAME&gt;\.ssh\</code> 的位置，而 Linux 的用戶會儲存在 <code>~/.ssh/</code> 的位置。</p>
<p>這裡是詢問你要不要把產生的 ssh key 重新命名，一般不會動到它的名字，按 Enter↩︎，接續下一步。</p>
<pre class="console_output"><code>Generating public/private rsa key pair.
Enter file in which to save the key (C:\Users\&lt;USERNAME&gt;/.ssh/id_rsa):</code></pre>
<p>這一步再詢問你需不需要將 SSH key pairs 加密，如果加密了，每次連線都需要打密碼。如果不想設定密碼就留空按 Enter↩︎ 進入下一步。</p>
<pre class="console_output"><code>Created directory 'C:\Users\&lt;USERNAME&gt;/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:</code></pre>
<p>產生 Key 會順帶產生這個 Key 的指紋。</p>
<pre class="console_output"><code>Your identification has been saved in C:\Users\&lt;USERNAME&gt;/.ssh/id_rsa.
Your public key has been saved in C:\Users\&lt;USERNAME&gt;/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:8NE76AD294Tjze76pEPtvZgqaqw9OuCF7T8HWPo6fUc qaz85@DESKTOP-OH6HA84
The key's randomart image is:
+---[RSA 3072]----+
|                 |
|         .       |
|    o . . .      |
|   . + o + .     |
|  o + o S.+      |
|.. = . =.E..     |
|..o.o ..+.=.     |
| ..+++.o.=.o.    |
|  o**++.=** ..   |
+----[SHA256]-----+</code></pre>
<p>產生完畢，儲存在 <code>C:\Users\&lt;USERNAME&gt;\.ssh\id_rsa</code> 的檔案是私鑰（private key），而另一個 <code>id_rsa.pub</code> 的檔案是公鑰（public key）。</p>
<div class="infobox caution">
<p>當你遺失了遠端主機的 key pairs，你再也不能透過遠端存取有使用過該 key pairs 的主機，只能透過直接接觸那台主機來更新的 key pairs，所以要妥善保存。</p>
</div>
</div>
<div id="step-3-將新增的-key-pairs-上傳至目的地主機" class="section level3" number="2.2.5">
<h3>
<span class="header-section-number">2.2.5</span> Step 3 — 將新增的 key pairs 上傳至目的地主機<a class="anchor" aria-label="anchor" href="#step-3-%E5%B0%87%E6%96%B0%E5%A2%9E%E7%9A%84-key-pairs-%E4%B8%8A%E5%82%B3%E8%87%B3%E7%9B%AE%E7%9A%84%E5%9C%B0%E4%B8%BB%E6%A9%9F"><i class="fas fa-link"></i></a>
</h3>
<p>當你擁有了 <a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#step-2-%E7%94%A2%E7%94%9F-ssh-key-pairs">Step 2 — 產生 ssh key pairs</a>，接下來要把 public key 上傳至虛擬機器。另外公鑰給別人看到是沒問題的，前面第一章的 [OpenSSH 設定 [可跳過]] 就已經有出現過我的公鑰了，公鑰並不能用來產生私鑰，它是用來認證這個 key 是否跟你所持有的私鑰相呼應。</p>
<div id="linux-系統" class="section level4" number="2.2.5.1">
<h4>
<span class="header-section-number">2.2.5.1</span> Linux 系統<a class="anchor" aria-label="anchor" href="#linux-%E7%B3%BB%E7%B5%B1"><i class="fas fa-link"></i></a>
</h4>
<p>如果你是的系統是 Linux 那指令會稍微短一些，上傳至遠端電腦的指令如下:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb14-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ssh-copy-id</span> <span class="at">-i</span> ~/.ssh/id_ed25519.pub <span class="at">-p</span> 22 asis@192.168.0.13</span></code></pre></div>
<ul>
<li><p><code>-i</code>: i flag 代表的是你要上傳的 public key 檔案路徑</p></li>
<li><p><code>-p</code>: p flag 則是目的地主機的 OpenSSH 伺服器的埠號</p></li>
<li><p><code>id_ed25519.pub</code> 為我產生的其他的 key pair，如果你前面是照著我的步驟產生，這裡應該改為 <code>id_rsa.pub</code></p></li>
<li><p>這裡的 <code>asis</code> 為第一章 <a href="intro.html#%E4%BD%BF%E7%94%A8%E8%80%85%E8%A8%AD%E5%AE%9A">使用者設定</a> 的預設使用者</p></li>
<li><p><code>192.168.0.13</code> 為我虛擬主機的 ip 位址，查詢 ip 位址可以先手動登入虛擬主機後，用 <code>hostname -I</code> 或是 <code>ip addr show</code> 指令查詢</p></li>
</ul>
<p>完成後會提示你已經可以使用 ssh 連線</p>
<pre class="console_output"><code>/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/kuaz/.ssh/id_ed25519.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh -p '22' 'asis@192.168.0.13'"
and check to make sure that only the key(s) you wanted were added.</code></pre>
<p>如果你是 Windows 的使用者也不用擔心多複雜，一樣一行指令就能搞定，這裡我是參考<span class="citation">(<a href="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99.html#ref-christopher_2020" role="doc-biblioref">Christopher 2020</a>)</span>的教學，指令如下:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode powershell prefixed_powershell"><code class="sourceCode powershell"><span id="cb16-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="va">$env</span><span class="op">:</span>USERPROFILE\<span class="op">.</span><span class="fu">ssh</span>\id_rsa<span class="op">.</span><span class="fu">pub</span> <span class="op">|</span> ssh asis@192<span class="op">.</span><span class="fu">168</span><span class="op">.</span><span class="fu">0</span><span class="op">.</span><span class="fu">13</span> <span class="st">"cat &gt;&gt; ~/.ssh/authorized_keys"</span></span></code></pre></div>
<ul>
<li><p>這裡的 <code>$env:USERPROFILE</code> 為 Windows 內建環境變數，會根據現在的使用者變更，如果我的使用者名稱為 <code>qaz855175b</code> 那 <code>$env:USERPROFILE</code> 對應的路徑就為 <code>C:\Users\qaz855175b\</code>，當然你可以直接把指令的 public key 路徑替換為 <code>C:\Users\qaz855175b\.ssh\id_rsa.pub</code></p></li>
<li><p><code>id_rsa.pub</code> 為產生的 public key 預設名稱</p></li>
<li><p>這裡的 <code>asis</code> 為第一章 <a href="intro.html#%E4%BD%BF%E7%94%A8%E8%80%85%E8%A8%AD%E5%AE%9A">使用者設定</a> 的預設使用者</p></li>
<li><p><code>192.168.0.13</code> 為我虛擬主機的 ip 位址，查詢 ip 位址可以先手動登入虛擬主機後，用 <code>hostname -I</code> 或是 <code>ip addr show</code> 指令查詢</p></li>
</ul>
<div class="infobox info">
<p>其實 Linux 的 <code>ssh-copy-id</code>、和第一章的從 Github 匯入 public key <code>ssh-import-id-gh</code> 與這裡的 <code>cat file &gt;&gt; ~/.ssh/authorized_keys</code> 都是在做同一件事情，把 public key 貼到遠端伺服器的使用者的 <code>authorized_keys</code> 檔案裡面。</p>
</div>
<p>接著按 Enter↩︎，跳出輸入密碼提示，這裡輸入預設的使用者密碼 <code>asis</code></p>
<pre class="console_output"><code>asis@192.168.0.13's password:</code></pre>
<p>輸入完後雖然沒有任何提示訊息，但其實已經可以使用 ssh 連線至遠端主機啦～</p>
</div>
</div>
<div id="step-4-測試-ssh-連線使用-ssh-連線至遠端主機" class="section level3" number="2.2.6">
<h3>
<span class="header-section-number">2.2.6</span> Step 4 — 測試 SSH 連線，使用 SSH 連線至遠端主機<a class="anchor" aria-label="anchor" href="#step-4-%E6%B8%AC%E8%A9%A6-ssh-%E9%80%A3%E7%B7%9A%E4%BD%BF%E7%94%A8-ssh-%E9%80%A3%E7%B7%9A%E8%87%B3%E9%81%A0%E7%AB%AF%E4%B8%BB%E6%A9%9F"><i class="fas fa-link"></i></a>
</h3>
<p>最後，使用 ssh 指令連接至遠端主機。</p>
<p>使用 OpenSSH Client 產生的 pair keys 可以直接使用這個方法連線。這裡介紹幾個常常與 ssh 一起出現的 flag :</p>
<ul>
<li><p><code>-v</code>: verbose，顯示連接時更詳細的訊息，除錯時常用</p></li>
<li><p><code>-p</code>: port;，遠端伺服器的埠號</p></li>
<li><p><code>-i</code>: 手動指定私鑰位置</p></li>
</ul>
<div class="infobox info">
<p>flag 通常會在指令後面隨後出現，flag前面會插入 <code>-</code>，而 flag 後面有時會需要加入詳細的設定，有時不用。flag 與 flag 之間用空格隔開，詳細指令的使用方法可以在 Linux 系統用 <code>man &lt;指令名稱&gt;</code> 查詢</p>
<p>假如我們要看連線的詳細訊息，且指定伺服器 port 為 60000與指定 private key 檔案位址等等，組合起來就是:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> <span class="at">-v</span> <span class="at">-p</span> 60000 <span class="at">-i</span> ~/.ssh/id_rsa asis@192.168.0.13</span></code></pre></div>
</div>
<p>目前不需要加上任何 flag，連線指令為：</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash prefixed_powershell"><code class="sourceCode bash"><span id="cb19-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> asis@192.168.0.13</span></code></pre></div>
<p>一樣地，<code>asis</code> 是使用者名稱，而<code>192.168.0.13</code> 是 OpenSSH 伺服器的 ip 位置，輸入完後按 Enter↩︎。</p>
<p>這邊打 <code>yes</code> 即可，確認連接目的地沒有錯之後，會把 fingerprint 寫入 <code>~/.ssh/known_hosts</code> 中，以後不再詢問。</p>
<pre class="console_output"><code>The authenticity of host '192.168.0.13 (192.168.0.13)' can't be established.
ECDSA key fingerprint is SHA256:/HoocrLXe63zycdlmkh/+U3RuUfkawNq/xA0gTJmqmM.
Are you sure you want to continue connecting (yes/no/[fingerprint])?</code></pre>
<div class="infobox info">
<p>這裡不用指定 private key 的原因是因為，當你用 ssh 連線至目的地伺服器且你沒有指定認證檔案（私鑰）時，<code>ssh</code> 會一個 key 一個 key 拿去問伺服器這個 key 可不可以使用。</p>
</div>
<p>連接成功!</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-49"></span>
<img src="figures/ssh-connection-success.png" alt="Windows Terminal 下的 SSH 連接成功畫面" width="80%"><p class="caption">
圖 2.2: Windows Terminal 下的 SSH 連接成功畫面
</p>
</div>
<p>測試完確認沒問題就可以把虛擬機晾在一旁了～</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-50"></span>
<img src="figures/virtualbox-ubuntu-login.png" alt="VirtualBox 的虛擬主機終端機畫面" width="80%"><p class="caption">
圖 2.3: VirtualBox 的虛擬主機終端機畫面
</p>
</div>
</div>
<div id="step-5-使遠端的-openssh-伺服器更加安全-可跳過" class="section level3" number="2.2.7">
<h3>
<span class="header-section-number">2.2.7</span> Step 5 — 使遠端的 OpenSSH 伺服器更加安全 [可跳過]<a class="anchor" aria-label="anchor" href="#step-5-%E4%BD%BF%E9%81%A0%E7%AB%AF%E7%9A%84-openssh-%E4%BC%BA%E6%9C%8D%E5%99%A8%E6%9B%B4%E5%8A%A0%E5%AE%89%E5%85%A8-%E5%8F%AF%E8%B7%B3%E9%81%8E"><i class="fas fa-link"></i></a>
</h3>
<div id="變更-ssh-伺服器預設的埠號" class="section level4" number="2.2.7.1">
<h4>
<span class="header-section-number">2.2.7.1</span> 變更 SSH 伺服器預設的埠號<a class="anchor" aria-label="anchor" href="#%E8%AE%8A%E6%9B%B4-ssh-%E4%BC%BA%E6%9C%8D%E5%99%A8%E9%A0%90%E8%A8%AD%E7%9A%84%E5%9F%A0%E8%99%9F"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb21-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> vim /etc/ssh/sshd_config</span></code></pre></div>
<p>將 <code>#Port 22</code> 取消註解，並把 <code>22</code> 改成其他介於 1-65535 之間的數字。</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#       $OpenBSD: sshd_config,v 1.103 2018/04/09 20:41:22 tj Exp $</span></span>
<span id="cb22-2"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the sshd server system-wide configuration file.  See </span></span>
<span id="cb22-4"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sshd_config(5) for more information.</span></span>
<span id="cb22-5"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># This sshd was compiled with PATH=/usr/bin:/bin:/usr/sbin:/sbin</span></span>
<span id="cb22-7"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The strategy used for options in the default sshd_config shipped with</span></span>
<span id="cb22-9"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># OpenSSH is to specify options with their default value where</span></span>
<span id="cb22-10"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># possible, but leave them commented.  Uncommented options override the</span></span>
<span id="cb22-11"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># default value.</span></span>
<span id="cb22-12"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Include</span> /etc/ssh/sshd_config.d/<span class="pp">*</span>.conf</span>
<span id="cb22-14"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Port</span> 60000</span>
<span id="cb22-16"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">#AddressFamily any</span></span>
<span id="cb22-17"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#ListenAddress 0.0.0.0</span></span>
<span id="cb22-18"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">#ListenAddress ::</span></span></code></pre></div>
</div>
<div id="關閉密碼驗證" class="section level4" number="2.2.7.2">
<h4>
<span class="header-section-number">2.2.7.2</span> 關閉密碼驗證<a class="anchor" aria-label="anchor" href="#%E9%97%9C%E9%96%89%E5%AF%86%E7%A2%BC%E9%A9%97%E8%AD%89"><i class="fas fa-link"></i></a>
</h4>
<p>將 PasswordAuthentication（以密碼驗證）設為 no。使用 SSH 連線時，如果沒有指定 SSH key pair，如果 OpenSSH 伺服器的設定沒有關閉，接著會要求你輸入使用者密碼以密碼驗證。通常這個設定會開啟是因為要<a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#step-3-%E5%B0%87%E6%96%B0%E5%A2%9E%E7%9A%84-key-pairs-%E4%B8%8A%E5%82%B3%E8%87%B3%E7%9B%AE%E7%9A%84%E5%9C%B0%E4%B8%BB%E6%A9%9F">Step 3 — 將新增的 key pairs 上傳至目的地主機</a>。</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">PasswordAuthentication</span> no</span></code></pre></div>
<p>當然如果密碼驗證為 no，且同時遺失 SSH 的 pair key 時，你就無法以 SSH 連線至遠端主機，需要實際的使用圖形介面操作虛擬機器。</p>
</div>
<div id="關閉遠端-root-登入" class="section level4" number="2.2.7.3">
<h4>
<span class="header-section-number">2.2.7.3</span> 關閉遠端 root 登入<a class="anchor" aria-label="anchor" href="#%E9%97%9C%E9%96%89%E9%81%A0%E7%AB%AF-root-%E7%99%BB%E5%85%A5"><i class="fas fa-link"></i></a>
</h4>
<p>避免 root 登入可以使系統避免過大的權限暴露。</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">PermitRootLogin</span> no</span></code></pre></div>
</div>
<div id="限制能使用-ssh-連線的使用者" class="section level4" number="2.2.7.4">
<h4>
<span class="header-section-number">2.2.7.4</span> 限制能使用 SSH 連線的使用者<a class="anchor" aria-label="anchor" href="#%E9%99%90%E5%88%B6%E8%83%BD%E4%BD%BF%E7%94%A8-ssh-%E9%80%A3%E7%B7%9A%E7%9A%84%E4%BD%BF%E7%94%A8%E8%80%85"><i class="fas fa-link"></i></a>
</h4>
<p>只允許特定的使用者使用 SSH 連線可大大降低風險。</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">AllowUsers</span> asis</span></code></pre></div>
</div>
<div id="關閉無密碼的使用者使用-ssh" class="section level4" number="2.2.7.5">
<h4>
<span class="header-section-number">2.2.7.5</span> 關閉無密碼的使用者使用 SSH<a class="anchor" aria-label="anchor" href="#%E9%97%9C%E9%96%89%E7%84%A1%E5%AF%86%E7%A2%BC%E7%9A%84%E4%BD%BF%E7%94%A8%E8%80%85%E4%BD%BF%E7%94%A8-ssh"><i class="fas fa-link"></i></a>
</h4>
<p>將沒有密碼就可以登入的使用者撤銷 SSH 連線的權限。</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">PermitEmptyPasswords</span> no</span></code></pre></div>
</div>
</div>
<div id="step-6-測試-sshd_config-是否有效" class="section level3" number="2.2.8">
<h3>
<span class="header-section-number">2.2.8</span> Step 6 — 測試 <code>sshd_config</code> 是否有效<a class="anchor" aria-label="anchor" href="#step-6-%E6%B8%AC%E8%A9%A6-sshd_config-%E6%98%AF%E5%90%A6%E6%9C%89%E6%95%88"><i class="fas fa-link"></i></a>
</h3>
<p><code>-t</code> 旗標可以測試 SSH 的設定是否有效，可以避免一些錯字造成的錯誤。</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb27-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> sshd <span class="at">-t</span></span></code></pre></div>
<p>將系統上的 SSH daemon 重新啟動，重新啟動 SSH 服務。</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb28-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl restart sshd</span></code></pre></div>
<p>確認 SSH 服務正常運行，沒有出現錯誤。</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb29-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl status sshd</span></code></pre></div>
<pre class="console_output"><code>● ssh.service - OpenBSD Secure Shell server
     Loaded: loaded (/lib/systemd/system/ssh.service; enabled; vendor preset: enabled)
     Active: active (running) since Sun 2021-08-15 16:08:55 UTC; 19h ago
       Docs: man:sshd(8)
             man:sshd_config(5)
    Process: 850 ExecStartPre=/usr/sbin/sshd -t (code=exited, status=0/SUCCESS)
   Main PID: 893 (sshd)
      Tasks: 1 (limit: 4617)
     Memory: 5.4M
     CGroup: /system.slice/ssh.service
             └─893 sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups

Aug 15 16:08:54 asis01 systemd[1]: Starting OpenBSD Secure Shell server...
Aug 15 16:08:55 asis01 sshd[893]: Server listening on 0.0.0.0 port 60000.
Aug 15 16:08:55 asis01 sshd[893]: Server listening on :: port 60000.
Aug 15 16:08:55 asis01 systemd[1]: Started OpenBSD Secure Shell server.</code></pre>
<p>最後指令 <code>exit</code> 斷開連線，再重新測試 ssh 遠端連線至伺服器，使用公鑰與私鑰驗證登入。</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash prefixed_powershell"><code class="sourceCode bash"><span id="cb31-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> <span class="at">-p</span> 60000 asis@192.168.0.13</span></code></pre></div>
<pre class="console_output"><code>Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-81-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Mon 16 Aug 2021 12:32:20 PM UTC

  System load:             0.0
  Usage of /:              0.7% of 974.32GB
  Memory usage:            5%
  Swap usage:              0%
  Processes:               124
  Users logged in:         0
  IPv4 address for enp0s3: 192.168.0.13
  IPv6 address for enp0s3: fd00:1cab:c0bb:acc2:a00:27ff:fed3:8136

 * Super-optimized for small spaces - read how we shrank the memory
   footprint of MicroK8s to make it the smallest full K8s around.

   https://ubuntu.com/blog/microk8s-memory-optimisation

0 updates can be applied immediately.


Last login: Mon Aug 16 12:31:35 2021 from 192.168.0.11</code></pre>
<p>連線成功～🖼</p>
</div>
</div>
<div id="apt" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> APT<a class="anchor" aria-label="anchor" href="#apt"><i class="fas fa-link"></i></a>
</h2>
<p>在 Ubuntu 上安裝任何程式大多都是用 APT (Advanced Packaging Tools) 安裝，這裡有兩個指令，用 <code>&amp;&amp;</code> 串接在一起:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb33-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> apt upgrade <span class="at">-y</span></span></code></pre></div>
<ul>
<li><p><code>apt update</code>: 更新可安裝的套件列表或版本</p></li>
<li><p><code>apt upgrade</code>: 安裝程式</p></li>
<li><p><code>&amp;&amp;</code>: <code>&amp;&amp;</code> 之前的指令執行成功才會接續執行 <code>&amp;&amp;</code> 後面的指令</p></li>
<li><p><code>-y, --yes, --assume-yes</code>: 自動對安裝提示回答 yes，安裝時會提示是否確認要安裝該軟體，因為我們清楚自己在做什麼為了方便而把提示關掉</p></li>
</ul>
</div>
<div id="ufw" class="section level2" number="2.4">
<h2>
<span class="header-section-number">2.4</span> UFW<a class="anchor" aria-label="anchor" href="#ufw"><i class="fas fa-link"></i></a>
</h2>
<p>UFW（Uncomplicated Firewall）是預設在 Ubuntu 系統上的防火牆，這裡先為了 OpenSSH 伺服器而打開埠號 <code>60000</code>。</p>
<p>首先用 status 查詢 UFW 的狀態，這裡需要輸入超級使用者 (sudo) 的密碼。</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb34-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ufw status</span></code></pre></div>
<p>看來預設的 UFW 是關閉的</p>
<pre class="console_output"><code>Status: inactive</code></pre>
<p>接著用 <code>systemctl</code> 打開防火牆</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb36-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable ufw</span></code></pre></div>
<p>查詢防火牆狀態</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb37-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ufw status</span></code></pre></div>
<pre class="console_output"><code>Status: active</code></pre>
<p>允許埠號 <code>60000</code> 從任何地方連入</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb39-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ufw allow 60000</span></code></pre></div>
<p>查詢防火牆狀態</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash prefixed"><code class="sourceCode bash"><span id="cb40-1"><a href="ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ufw status</span></code></pre></div>
<p>目前只有兩條規則，分別是 從任何地方連入埠號 60000 與 ipv6 從任何地方連入埠號 60000</p>
<pre class="console_output"><code>Status: active

To                         Action      From
--                         ------      ----
60000                      ALLOW       Anywhere
60000 (v6)                 ALLOW       Anywhere (v6)</code></pre>

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="intro.html"><span class="header-section-number">1</span> 虛擬主機</a></div>
<div class="next"><a href="lamp-%E7%A8%8B%E5%BC%8F%E9%9B%86.html"><span class="header-section-number">3</span> LAMP 程式集</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#ubuntu-%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A"><span class="header-section-number">2</span> Ubuntu 的基本設定</a></li>
<li><a class="nav-link" href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99-1"><span class="header-section-number">2.1</span> 事前準備</a></li>
<li>
<a class="nav-link" href="#openssh"><span class="header-section-number">2.2</span> OpenSSH</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="header-section-number">2.2.1</span> 概述</a></li>
<li><a class="nav-link" href="#%E9%81%A9%E5%90%88%E5%90%84%E5%80%8B%E7%B3%BB%E7%B5%B1%E7%9A%84%E9%80%A3%E7%B7%9A%E6%B5%81%E7%A8%8B"><span class="header-section-number">2.2.2</span> 適合各個系統的連線流程</a></li>
<li><a class="nav-link" href="#step-1-%E5%AE%89%E8%A3%9D-openssh-client"><span class="header-section-number">2.2.3</span> Step 1 — 安裝 OpenSSH Client</a></li>
<li><a class="nav-link" href="#step-2-%E7%94%A2%E7%94%9F-ssh-key-pairs"><span class="header-section-number">2.2.4</span> Step 2 — 產生 ssh key pairs</a></li>
<li><a class="nav-link" href="#step-3-%E5%B0%87%E6%96%B0%E5%A2%9E%E7%9A%84-key-pairs-%E4%B8%8A%E5%82%B3%E8%87%B3%E7%9B%AE%E7%9A%84%E5%9C%B0%E4%B8%BB%E6%A9%9F"><span class="header-section-number">2.2.5</span> Step 3 — 將新增的 key pairs 上傳至目的地主機</a></li>
<li><a class="nav-link" href="#step-4-%E6%B8%AC%E8%A9%A6-ssh-%E9%80%A3%E7%B7%9A%E4%BD%BF%E7%94%A8-ssh-%E9%80%A3%E7%B7%9A%E8%87%B3%E9%81%A0%E7%AB%AF%E4%B8%BB%E6%A9%9F"><span class="header-section-number">2.2.6</span> Step 4 — 測試 SSH 連線，使用 SSH 連線至遠端主機</a></li>
<li><a class="nav-link" href="#step-5-%E4%BD%BF%E9%81%A0%E7%AB%AF%E7%9A%84-openssh-%E4%BC%BA%E6%9C%8D%E5%99%A8%E6%9B%B4%E5%8A%A0%E5%AE%89%E5%85%A8-%E5%8F%AF%E8%B7%B3%E9%81%8E"><span class="header-section-number">2.2.7</span> Step 5 — 使遠端的 OpenSSH 伺服器更加安全 [可跳過]</a></li>
<li><a class="nav-link" href="#step-6-%E6%B8%AC%E8%A9%A6-sshd_config-%E6%98%AF%E5%90%A6%E6%9C%89%E6%95%88"><span class="header-section-number">2.2.8</span> Step 6 — 測試 sshd_config 是否有效</a></li>
</ul>
</li>
<li><a class="nav-link" href="#apt"><span class="header-section-number">2.3</span> APT</a></li>
<li><a class="nav-link" href="#ufw"><span class="header-section-number">2.4</span> UFW</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/exkuretrol/MCU-ASIS/blob/main/02-ubuntu.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/exkuretrol/MCU-ASIS/edit/main/02-ubuntu.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>MCU ASIS Ubuntu 系統安裝指南</strong>" was written by Chiawei Chen. It was last built on 2023-07-21.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
