# LAMP

LAMP æ˜¯ç”± 4 å€‹å–®å­—é–‹é ­çš„å­—çµ„æˆçš„è©ã€‚ LAMP è®“ä½ å¯ä»¥åœ¨ä¸€å°ç³»çµ±ç‚º **L**inux çš„é›»è…¦ä¸Šï¼Œç”¨ **A**pache æ¶è¨­ç¶²ç«™ä¼ºæœå™¨ï¼Œå…¶ä¸­å„²å­˜åœ¨ **M**ySQL è£¡é¢ï¼Œæœ€å¾Œç”¨ **P**HP åŸ·è¡Œå‹•æ…‹çš„ç¶²ç«™ã€‚

é€™ç« æœƒæ•™ä½ æ€éº¼å®‰è£ LAMP ç¨‹å¼é›†ã€‚

## äº‹å‰æº–å‚™

åœ¨å®‰è£è»Ÿé«”ä¹‹å‰ï¼Œä½ éœ€è¦æœ‰ä¸€å€‹å¯ä»¥åŸ·è¡Œ `sudo` æŒ‡ä»¤çš„ä½¿ç”¨è€…ã€‚ å¦‚æœä½ æ˜¯ç…§è‘—å…ˆå‰çš„æ•™å­¸åšçš„è©±ï¼Œé€™å€‹ä½¿ç”¨è€…ç‚ºå®‰è£æ™‚çš„é è¨­ä½¿ç”¨è€… `asis`ã€‚

## Apache

### Step 1 --- å®‰è£ Apache

å¾ä¾†æºæ›´æ–°å¥—ä»¶è³‡æ–™ï¼š

``` {.bash .prefixed}
sudo apt update
```

ç¢ºèªæ˜¯å¦æ˜¯æˆ‘å€‘è¦å®‰è£çš„ Apache2

``` {.bash .prefixed}
sudo apt info apache2
```

``` {.console_output}
Package: apache2
Version: 2.4.41-4ubuntu3.4
Priority: optional
Section: web
Origin: Ubuntu
Maintainer: Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>
Original-Maintainer: Debian Apache Maintainers <debian-apache@lists.debian.org>
Bugs: https://bugs.launchpad.net/ubuntu/+filebug
Installed-Size: 542 kB
Provides: httpd, httpd-cgi
Pre-Depends: dpkg (>= 1.17.14)
Depends: apache2-bin (= 2.4.41-4ubuntu3.4), apache2-data (= 2.4.41-4ubuntu3.4), apache2-utils (= 2.4.41-4ubuntu3.4), lsb-base, mime-support, perl:any, procps
Recommends: ssl-cert
Suggests: apache2-doc, apache2-suexec-pristine | apache2-suexec-custom, www-browser, ufw
Conflicts: apache2.2-bin, apache2.2-common
Breaks: libapache2-mod-proxy-uwsgi (<< 2.4.33)
Replaces: apache2.2-bin, apache2.2-common, libapache2-mod-proxy-uwsgi (<< 2.4.33)
Homepage: https://httpd.apache.org/
Task: lamp-server
Download-Size: 95.5 kB
APT-Sources: http://tw.archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages
Description: Apache HTTP Server
 The Apache HTTP Server Project's goal is to build a secure, efficient and
 extensible HTTP server as standards-compliant open source software. The
 result has long been the number one web server on the Internet.
 .
 Installing this package results in a full installation, including the
 configuration files, init scripts and support scripts.
```

å®‰è£ Apache2

``` {.bash .prefixed}
sudo apt install apache2
```

``` {.console_output}
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following additional packages will be installed:
  apache2-bin apache2-data apache2-utils libapr1 libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap
  libjansson4 liblua5.2-0 ssl-cert
Suggested packages:
  apache2-doc apache2-suexec-pristine | apache2-suexec-custom www-browser openssl-blacklist
The following NEW packages will be installed:
  apache2 apache2-bin apache2-data apache2-utils libapr1 libaprutil1 libaprutil1-dbd-sqlite3
  libaprutil1-ldap libjansson4 liblua5.2-0 ssl-cert
0 upgraded, 11 newly installed, 0 to remove and 0 not upgraded.
Need to get 1,865 kB of archives.
After this operation, 8,083 kB of additional disk space will be used.
Do you want to continue? [Y/n] 
```

ä¹Ÿå¯ä»¥åœ¨å®‰è£æ™‚åŠ ä¸Š `--yes` ç•¥éç¢ºèªå®‰è£æç¤ºã€‚

``` {.bash .console_output}
sudo apt install apache2 --yes
```

### Step 2 --- èª¿æ•´é˜²ç«ç‰† ufw è¨­å®š

æœ‰äº›ç¨‹å¼æœƒè‡ªå‹•æŠŠè¨­å®šæª”åŠ å…¥ ufw ä¸­ï¼Œé€™æ¨£å°±å¯ä»¥é€éè¨­å®šæª”å•Ÿç”¨/é—œé–‰è¨­å®šé˜²ç«ç‰†å…è¨±çš„åŸ è™Ÿï¼Œä¸ç”¨å†ç‰¹åˆ¥è¨˜ä¸‹è©²è»Ÿé«”çš„è¨­å®šã€‚ å¯ä»¥é€éæŒ‡ä»¤é¡¯ç¤ºæœ‰ä»€éº¼å¯ç”¨çš„æ‡‰ç”¨ç¨‹å¼è¨­å®šæª”ã€‚

``` {.bash .prefixed}
sudo ufw app list
```

ä¸‹åˆ—æ˜¯ç›®å‰å¯ç”¨çš„è¨­å®šæª”ï¼š

``` {.console_output}
Available applications:
  Apache
  Apache Full
  Apache Secure
  OpenSSH
```

-   **Apache**ï¼šæœƒåœ¨é˜²ç«ç‰†æ–°å¢ä¸€å€‹å…è¨±å¾ä»»ä½•åœ°æ–¹é€£ç·šè‡³åŸ è™Ÿ `80` çš„è¦å‰‡ã€‚

-   **Apache Full**ï¼šæœƒåœ¨é˜²ç«ç‰†æ–°å¢ä¸€å€‹å…è¨±å¾ä»»ä½•åœ°æ–¹é€£ç·šè‡³åŸ è™Ÿ `80` èˆ‡åŸ è™Ÿ `443` çš„è¦å‰‡ã€‚

-   **Apache Secure**ï¼šåœ¨é˜²ç«ç‰†æ–°å¢ä¸€å€‹å…è¨±å¾ä»»ä½•åœ°æ–¹é€£ç·šè‡³åŸ è™Ÿ `443` çš„è¦å‰‡ã€‚\

ä½¿ç”¨æ–¹å¼å¾ˆç°¡å–®ï¼Œè·Ÿå…è¨±åŸ è™Ÿæ™‚çš„æŒ‡ä»¤ä¸€æ¨£ï¼ŒæŠŠåŸ è™Ÿæ”¹æˆè¨­å®šæª”åç¨±å³å¯ã€‚

``` {.bash .prefixed}
sudo ufw allow "Apache"
```

``` {.console_output}
Rule added
Rule added (v6)
```

ç¢ºèªå‰›æ‰æœ‰æ²’æœ‰æ–°å¢æˆåŠŸï¼š

``` {.bash .prefixed}
sudo ufw status
```

``` {.console_output}
Status: active

To                         Action      From
--                         ------      ----
60000                      ALLOW       Anywhere                  
Apache                     ALLOW       Anywhere                  
60000 (v6)                 ALLOW       Anywhere (v6)             
Apache (v6)                ALLOW       Anywhere (v6) 
```

æ¥è‘—å¯ä»¥é€éç€è¦½å™¨é€£ç·šåˆ°ä¸‹åˆ—ç¶²å€ï¼š

    http://<è™›æ“¬ä¸»æ©Ÿçš„ ip åœ°å€>/

![](figures/apache-main-page.png)

::: {.infobox .info}
å¿˜è¨˜æ€éº¼æ‰¾ ip å¯ä»¥ç”¨ä¸‹åˆ—ä¸‰ç¨®æ–¹æ³•æ‰¾åˆ°ï¼š

1.  `ip show addr`

``` {.console_output .numberLines}
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:59:13:f9 brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.14/24 brd 192.168.0.255 scope global dynamic enp0s3
       valid_lft 315329303sec preferred_lft 315329303sec
    inet6 fd00:1cab:c0bb:acc2:a00:27ff:fe59:13f9/64 scope global dynamic mngtmpaddr noprefixroute 
       valid_lft 535427sec preferred_lft 401570sec
    inet6 fe80::a00:27ff:fe59:13f9/64 scope link 
       valid_lft forever preferred_lft forever
```

2.  `hostname -I`

``` {.console_output}
192.168.0.14 fd00:1cab:c0bb:acc2:a00:27ff:fe59:13f9
```

3.  `curl ifconfig.me`

``` {.console_output}
XXX.XXX.XXX.XXX
```

æ³¨æ„ï¼šé€™æ˜¯å°å¾ä½ çš„å€åŸŸç¶²è·¯é€£ç·šåˆ°å°å¤–çš„ç¶²è·¯ ipï¼Œå¦‚æœä½ ä¸çŸ¥é“æ˜¯ä»€éº¼ï¼Œç”¨æ–¹æ³• 1 è·Ÿ 2 ä»£æ›¿ã€‚
:::

## MySQL

### Step 1 --- å®‰è£ MySQL

é€é Apt å®‰è£ MySQLï¼š

``` {.bash .prefixed}
sudo apt install mysql-server -y
```

### Step 2 --- è¨­å®š MySQL

æŒ‡ä»¤ `mysql_secure_installation` æœƒåšä»¥ä¸‹å¹¾ä»¶äº‹ï¼ˆè©³ç´°çš„èªªæ˜å¯ä»¥åœ¨[é€™è£¡](https://dev.mysql.com/doc/refman/8.0/en/mysql-secure-installation.html)æ‰¾åˆ°ï¼‰ï¼š

-   ä½ å¯ä»¥è¨­å®š `root` å¸³è™Ÿçš„å¯†ç¢¼ã€‚

-   ä½ å¯ä»¥ç§»é™¤ `root` å¸³è™Ÿé è¨­å¯ä»¥å¾ä»»ä½•åœ°æ–¹é€£ç·šè‡³æœ¬æ©Ÿçš„è¨­å®šã€‚

-   ä½ å¯ä»¥ç§»é™¤æ²’æœ‰åç¨±çš„åŒ¿åå¸³è™Ÿï¼ˆanonymous-userï¼‰è©³ç´°èªªæ˜å¯ä»¥å¾[é€™è£¡](https://dev.mysql.com/doc/refman/5.6/en/default-privileges.html)æ‰¾åˆ°ã€‚

-   ä½ å¯ä»¥ç§»é™¤é è¨­çš„ `test` è³‡æ–™åº«ï¼ˆé€™å€‹è³‡æ–™åº«ä»»ä½•äººéƒ½å¯ä»¥å­˜å–ï¼Œç”šè‡³æ˜¯åŒ¿åå¸³è™Ÿï¼‰ï¼Œå’Œä»»ä½•ä½¿ç”¨è€…åç¨±æ˜¯ `test_` é–‹é ­çš„ä½¿ç”¨è€…å¸³è™Ÿå¯ä»¥å­˜å–ä»»ä½•è³‡æ–™åº«çš„æ¬Šé™ã€‚

``` {.bash .orefixed}
sudo mysql_secure_installation
```

å»ºè­°é€™è£¡é¸ `No`ã€‚å¦‚æœé€™è£¡é¸äº† `Yes`ï¼Œé‚£ä¹‹å¾Œåªè¦æ˜¯å‰µå»ºä½¿ç”¨è€…éƒ½æœƒè¦æ±‚ä½ ä½¿ç”¨å¯†ç¢¼å¼·åº¦å¾ˆé«˜çš„å¯†ç¢¼ã€‚

``` {.console_output}
Securing the MySQL server deployment.

Connecting to MySQL using a blank password.

VALIDATE PASSWORD COMPONENT can be used to test passwords
and improve security. It checks the strength of password
and allows the users to set only those passwords which are
secure enough. Would you like to setup VALIDATE PASSWORD component?

Press y|Y for Yes, any other key for No: No
```

è¨­å®š root å¯†ç¢¼ï¼Œé€™è£¡é¸ `Yes`

``` {.console_output}
Change the password for root ? ((Press y|Y for Yes, any other key for No) : Yes
```

å¦‚æœé€™è£¡é¸äº† `Yes`ï¼Œé‚£ MySQL æ¥ä¸‹ä¾†æœƒè¦æ±‚ä½ è¼¸å…¥å¯†ç¢¼å¼·åº¦è¼ƒé«˜çš„å¯†ç¢¼ã€‚

é€™å€‹éšæ®µæ˜¯å•ä½ è¦ä¸è¦åˆªé™¤åŒ¿åå¸³è™Ÿï¼Œé€™è£é¸æ“‡ `Yes`

``` {.console_output}
By default, a MySQL installation has an anonymous user,
allowing anyone to log into MySQL without having to have
a user account created for them. This is intended only for
testing, and to make the installation go a bit smoother.
You should remove them before moving into a production
environment.

Remove anonymous users? (Press y|Y for Yes, any other key for No) : Y
```

é€™è£æ˜¯å•ä½ è¦ä¸è¦è®“ `root` å¸³è™Ÿå¯ä»¥å¾ä»»ä½•åœ°æ–¹é€£å…¥ï¼Œé€™è£¡ç•¶ç„¶æ˜¯é¸ `No`

``` {.console_output}
Normally, root should only be allowed to connect from
'localhost'. This ensures that someone cannot guess at
the root password from the network.

Disallow root login remotely? (Press y|Y for Yes, any other key for No) : Y
```

``` {.console_output}
 - Dropping test database...
Success.

 - Removing privileges on test database...
Success.

Reloading the privilege tables will ensure that all changes
made so far will take effect immediately.

Reload privilege tables now? (Press y|Y for Yes, any other key for No) : Y
Success.

All done! 
```

æ¸¬è©¦ MySQL é€£ç·šï¼š

`{.bash prefixed} mysql -u root -p`

## PHP

### Step 1 --- å®‰è£ php & php-mysql æ’ä»¶

å…ˆç¢ºèª `php` æ˜¯ä¸æ˜¯æˆ‘å€‘è¦å®‰è£çš„ç‰ˆæœ¬

``` {.bash .prefixed}
sudo apt info php
```

å¯ä»¥çœ‹åˆ°ï¼Œç›®å‰ `php` çš„ä¾è³´å¥—ä»¶æ˜¯ `php7.4`ï¼Œä»£è¡¨å°‡å®‰è£çš„ç‰ˆæœ¬ç‚º `php7.4`

``` {.console_output}
Package: php
Version: 2:7.4+75
Priority: optional
Section: php
Source: php-defaults (75)
Origin: Ubuntu
Maintainer: Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>
Original-Maintainer: Debian PHP Maintainers <team+pkg-php@tracker.debian.org>
Bugs: https://bugs.launchpad.net/ubuntu/+filebug
Installed-Size: 13.3 kB
Depends: php7.4
Download-Size: 2,712 B
APT-Sources: http://tw.archive.ubuntu.com/ubuntu focal/main amd64 Packages
Description: server-side, HTML-embedded scripting language (default)
 PHP (recursive acronym for PHP: Hypertext Preprocessor) is a widely-used
 open source general-purpose scripting language that is especially suited
 for web development and can be embedded into HTML.
 .
 This package is a dependency package, which depends on latest stable
 PHP version (currently 7.4).
```

æ¥è‘—ï¼Œæˆ‘å€‘å†æŸ¥è©¢ä¸€æ¬¡ `php7.4` æœƒå®‰è£ä»€éº¼æ±è¥¿

``` {.bash .prefixed}
sudo apt info php7.4
```

é€™è£¡å¯ä»¥çœ‹åˆ° `php7.4` å®‰è£äº†æœƒå®‰è£ä¸€äº›ä½¿ php7.4 é †åˆ©é‹ä½œçš„ä¾è³´å¥—ä»¶ï¼Œåƒæ˜¯ `libapache2-mod-php7.4`ã€`php7.4-fpm`ã€`php7.4-cgi` èˆ‡ `php7.4-common`

``` {.console_output}
Package: php7.4
Version: 7.4.3-4ubuntu2.5
Priority: optional
Section: php
Origin: Ubuntu
Maintainer: Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>
Original-Maintainer: Debian PHP Maintainers <team+pkg-php@tracker.debian.org>
Bugs: https://bugs.launchpad.net/ubuntu/+filebug
Installed-Size: 73.7 kB
Provides: php
Depends: libapache2-mod-php7.4 | php7.4-fpm | php7.4-cgi, php7.4-common
Homepage: http://www.php.net/
Download-Size: 9,244 B
APT-Sources: http://tw.archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages
Description: server-side, HTML-embedded scripting language (metapackage)
 This package is a metapackage that, when installed, guarantees that you
 have at least one of the four server-side versions of the PHP interpreter
 installed. Removing this package won't remove PHP from your system, however
 it may remove other packages that depend on this one.
 .
 PHP (recursive acronym for PHP: Hypertext Preprocessor) is a widely-used
 open source general-purpose scripting language that is especially suited
 for web development and can be embedded into HTML.
```

ä¸€æ¨£åœ°ï¼Œé€™è£¡ä¹Ÿç”¨ç›¸åŒçš„æŒ‡ä»¤æŸ¥è©¢ `php-mysql` å¥—ä»¶

``` {.console_output}
sudo apt info php-mysql
```

å› ç‚º `php` å·²ç¶“æœ‰ `php-common` ä¾è³´çš„ï¼Œæ‰€ä»¥å¾…æœƒå…©å€‹å¥—ä»¶ä¸€èµ·å®‰è£æ™‚ï¼Œåªæœƒå®‰è£ä¸€å€‹ `php-common`

``` {.console_output}
Package: php-mysql
Version: 2:7.4+75
Priority: optional
Section: php
Source: php-defaults (75)
Origin: Ubuntu
Maintainer: Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>
Original-Maintainer: Debian PHP Maintainers <team+pkg-php@tracker.debian.org>
Bugs: https://bugs.launchpad.net/ubuntu/+filebug
Installed-Size: 13.3 kB
Depends: php-common, php7.4-mysql
Task: lamp-server
Download-Size: 2,000 B
APT-Sources: http://tw.archive.ubuntu.com/ubuntu focal/main amd64 Packages
Description: MySQL module for PHP [default]
 This package provides a MySQL module for PHP.
 .
 PHP (recursive acronym for PHP: Hypertext Preprocessor) is a widely-used
 open source general-purpose scripting language that is especially suited
 for web development and can be embedded into HTML.
 .
 This package is a dependency package, which depends on Debian's default
 PHP version (currently 7.4).
```

ç¢ºèªå®Œæˆ‘å€‘è¦å®‰è£çš„ç‰ˆæœ¬æ˜¯å¦æ­£ç¢ºå¾Œï¼Œç”¨å¥—ä»¶ç®¡ç†ç¨‹å¼ `apt` å®‰è£å¥—ä»¶ã€‚

``` {.bash .prefixed}
sudo apt install php php-mysql --yes
```

ç¢ºèª `php` æ˜¯å¦å®‰è£å®Œæˆï¼Œå¯ä»¥ç”¨ `which` æŒ‡ä»¤ç¢ºèªï¼š

``` {.bash .prefixed}
which php
```

ç•¶ç³»çµ±ä¸­æœ‰å®‰è£è¤‡æ•¸å€‹ç‰ˆæœ¬çš„ php æ™‚ï¼Œå®‰è£çš„ä½ç½®å¯èƒ½æœƒæœ‰æ‰€ä¸åŒï¼Œé€™åœ¨ç¬¬ 5 ç« ï¼Œå®‰è£ python æ™‚æœƒé‡åˆ°ã€‚

<!--# TODO: é€£çµè‡³ç¬¬äº”ç«  python èªªæ˜ which -A æŒ‡ä»¤ -->

``` {.console_output}
/usr/bin/php
```

ç¢ºèª `php` å®‰è£ç‰ˆæœ¬ï¼š

``` {.bash .bash}
php --version
```

``` {.console_output}
PHP 7.4.3 (cli) (built: Jul  5 2021 15:13:35) ( NTS )
Copyright (c) The PHP Group
Zend Engine v3.4.0, Copyright (c) Zend Technologies
    with Zend OPcache v7.4.3, Copyright (c), by Zend Technologies
```

### Step 2 --- å»ºç«‹è™›æ“¬ç¶²ç«™ï¼ˆVirtualHostï¼‰

æ–¼ apache2 çš„è¨­å®šè³‡æ–™å¤¾ä¸­ï¼Œæ–°å»ºä¸€å€‹å«åš asis.conf çš„è¨­å®šæª”ï¼š

``` {.bash .prefixed}
sudo vim /etc/apache2/sites-available/asis.conf
```

å¯«å…¥æ¸¬è©¦ç”¨çš„è¨­å®š

    <VirtualHost *:80>
        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/asis
        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined
    </VirtualHost>

é€é list æŒ‡ä»¤å¯ä»¥çœ‹åˆ°ï¼Œè³‡æ–™å¤¾çš„æ“æœ‰è€…æ˜¯ rootã€‚ æˆ‘å€‘åœ¨å®‰è£ Apache2 çš„éƒ¨åˆ†å¾ `http://<è™›æ“¬ä¸»æ©Ÿçš„ ip åœ°å€>/` çœ‹åˆ°çš„å°±æ˜¯ä½æ–¼ `/var/www/html/` ä¸­çš„é¦–é ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘è¦åˆªé™¤ Apache2 é è¨­çš„è¨­å®šï¼Œä¸¦æ¸¬è©¦è‡ªå·±å»ºç«‹çš„è™›æ“¬ç¶²ç«™ï¼ˆVirtualHostï¼‰ã€‚

``` {.bash .prefixed}
ls -al /var/www/
```

``` {.console_output}
total 12
drwxr-xr-x  3 root root 4096 Sep  1 06:51 ./
drwxr-xr-x 14 root root 4096 Sep  1 06:51 ../
drwxr-xr-x  2 root root 4096 Sep  1 06:51 html/
```

ä¸€æ¨£åœ°ï¼Œä»¥åŒæ¨£åœ°æ–¹æ³•å»ºç«‹ `asis` è³‡æ–™å¤¾

``` {.bash .prefixed}
sudo mkdir /var/www/asis
```

ç”¢ç”Ÿä¸€å€‹æ¸¬è©¦ç”¨çš„é¦–é 

``` {.bash .prefixed}
sudo vim /var/www/asis/index.html
```

``` {.html}
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apache VirtualHost config test</title>
</head>
<body>
  <h1>æˆåŠŸ!</h1>
  <p>æ‚¨çš„ Apache2 è™›æ“¬ç¶²ç«™çš„è¨­å®šé †åˆ©é‹ä½œä¸­ã€‚</p>
</body>
</html>
```

ä½¿ç”¨ `a2dissite` æŒ‡ä»¤é—œé–‰é è¨­çš„è¨­å®šæª”ï¼ˆæœ‰èˆˆè¶£å¯ä»¥çœ‹ä¸€ä¸‹é è¨­çš„è¨­å®šæª” 000-default.confï¼Œæœ‰åŠ©æ–¼äº†è§£è¨­å®šæª”æ¡ˆæ€éº¼ç·¨å¯«ï¼‰

``` {.bash .prefixed}
sudo a2dissite 000-default.conf
```

``` {.console_output}
Site 000-default disabled.
To activate the new configuration, you need to run:
  systemctl reload apache2
```

æ¥è‘—ï¼Œå•Ÿç”¨å‰›æ‰å‰µç«‹çš„è¨­å®šæª” `asis.conf`

``` {.bash .prefixed}
sudo a2ensite asis.conf
```

é‡æ–°è®€å–å‰›æ‰è®Šæ›´çš„è¨­å®šï¼Œä½¿æ–°çš„è¨­å®šç”Ÿæ•ˆ

``` {.bash .prefixed}
sudo systemctl reload apache2
```

æ¥è‘—è‡³ç€è¦½å™¨æ‰“ä¸Šè™›æ“¬ä¸»æ©Ÿçš„ ip ä½å€

    http://<è™›æ“¬ä¸»æ©Ÿçš„ ip åœ°å€>/

![](figures/apache2-test-virtualhost-conf.png)

æˆ–æ˜¯ç›´æ¥åœ¨çµ‚ç«¯æ©Ÿä¸­ä½¿ç”¨æŒ‡ä»¤ `curl` æ¸¬è©¦ `asis.conf` è¨­å®šæª”ï¼š

``` {.bash .prefixed}
curl http://192.168.0.14
```

``` {.console_output}
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apache VirtualHost config test</title>
</head>
<body>
  <h1>æˆåŠŸ!</h1>
  <p>æ‚¨çš„ Apache2 è™›æ“¬ç¶²ç«™çš„è¨­å®šé †åˆ©é‹ä½œä¸­ã€‚</p>
</body>
</html>
```

## phpMyAdmin

### Step 1 --- å®‰è£ phpmyadmin

ä¸€æ¨£åœ°ï¼Œç¢ºèª `phpmyadmin` çš„ç‰ˆæœ¬

``` {.bash .prefixed}
sudo apt info phpmyadmin
```

``` {.console_output}
Package: phpmyadmin
Version: 4:4.9.5+dfsg1-2
Priority: optional
Section: universe/web
Origin: Ubuntu
Maintainer: Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>
Original-Maintainer: phpMyAdmin Packaging Team <team+phpmyadmin@tracker.debian.org>
Bugs: https://bugs.launchpad.net/ubuntu/+filebug
Installed-Size: 27.2 MB
Depends: php, php-cli, php-mysql, php-json, php-mbstring, php-xml, debconf (>= 0.5) | debconf-2.0, lib
js-sphinxdoc (>= 1.0), sensible-utils, dbconfig-mysql | dbconfig-no-thanks | dbconfig-common (<< 2.0.0
), php-phpseclib (>= 2.0), php-common, php-phpmyadmin-sql-parser (>= 4.3.2), php-phpmyadmin-sql-parser
 (<< 5~~), php-phpmyadmin-motranslator (>= 5.0), php-phpmyadmin-motranslator (<< 6~~), php-phpmyadmin-
shapefile (>= 2.0), php-phpmyadmin-shapefile (<< 3~~), php-phpseclib (<< 3~~), php-google-recaptcha (>
= 1.1), php-google-recaptcha (<< 2~~), php-psr-container (>= 1.0), php-psr-container (<< 2~~), php-twi
g (>= 2.9), php-twig (<< 3~~), php-twig-extensions (>= 1.5.1), php-twig-extensions (<< 1.6~~), php-sym
fony-expression-language, libjs-openlayers, ucf (>= 0.28)
Recommends: apache2 | lighttpd | httpd, php-curl, php-gd, php-bz2, php-zip, php-tcpdf
Suggests: default-mysql-server | virtual-mysql-server, www-browser, php-recode, php-opcache, php-gd2, 
php-pragmarx-google2fa, php-bacon-qr-code, php-samyoul-u2f-php-server
Homepage: https://www.phpmyadmin.net/
Download-Size: 4,426 kB

[...]
```

ç¢ºèªå®Œç•¢å¾Œå®‰è£

``` {.bash .prefixed}
sudo apt install phpmyadmin --yes
```

é€™è£ç”¨ç©ºç™½éµå‹¾é¸ `apache2` ä½¿ä¸­æ‹¬è™Ÿä¸­è®Šæˆæ˜Ÿè™Ÿ `*`

![](figures/phpmyadmin-installation_0.png)

é€™è£é¸æ“‡ `Yes` å³å¯é™¤éä½ æƒ³å° `phpmyadmin` åšæ›´è©³ç´°çš„è¨­å®š

![](figures/phpmyadmin-installation_1.png)

ç•™ç©ºæœƒè‡ªå‹•ç”¢ç”Ÿä¾› `phpmyadmin` é€£ç·šè‡³ MySQL ç”¨çš„å¯†ç¢¼ï¼Œæ‰€ä»¥é€™è£¡ç›´æ¥æŒ‰ `Ok`

![](figures/phpmyadmin-installation_2.png)

::: {.infobox .warning}
ç•¶å‡ºç¾æ­¤éŒ¯èª¤æ™‚ä¸ç”¨å¤ªæ…Œå¼µï¼Œæ˜¯å› ç‚ºå®‰è£ MySQL æ™‚ï¼Œæœ‰é–‹å•Ÿ `Validate Password` æ’ä»¶å°è‡´çš„ï¼Œåªéœ€è¦é€éä¸‹åˆ—æŒ‡ä»¤æš«æ™‚é—œé–‰å³å¯ã€‚

![](figures/phpmyadmin-installation-error.png)

ä»¥ root ç™»å…¥è³‡æ–™åº«

``` {.bash .prefixed}
mysql -u root -p
```

è§£é™¤å®‰è£æ’ä»¶ valid password

``` {.sqlmysql .prefixed_mysql}
uninstall component 'file://component_valid_password';
```

``` {.sqlmysql .prefixed_mysql .infobox .warning}
exit;
```

åœ¨å®‰è£ä¸€æ¬¡ `phpmyadmin`

``` {.bash .prefixed .infobox .warning}
sudo apt install phpmyadmin --yes
```

``` {.bash .prefixed}
mysql -u root -p
```

å°‡ valid password è£å›å»

``` {.sqlmysql .prefixed_mysql .infobox .warning}
install component 'file://component_valid_password'
```

``` {.sqlmysql .prefixed_mysql .infobox .warning}
exit;
```
:::

å•Ÿå‹• phpMyAdmin çš„ä¾è³´æ’ä»¶

``` {.bash .prefixed}
sudo phpenmod mbstring
```

é‡æ–°å•Ÿå‹• Apache2

``` {.bash .prefixed}
sudo systemctl restart apache2
```

å¾ç¶²ç«™é€²å…¥ phpMyAdmin æ“ä½œä»‹é¢

    http://<è™›æ“¬ä¸»æ©Ÿçš„ ip åœ°å€>/phpmyadmin/

å¦‚æœæ‰¾ä¸åˆ°æ˜¯æ­£å¸¸çš„ï¼Œåœ¨ Ubuntu 20.04 å®‰è£ phpMyAdmin æ™‚ï¼Œæ²’æœ‰æ­£ç¢ºçš„è¨­å®šåˆ° phpMyAdminã€‚ å¯ä»¥åƒè€ƒ[é€™è£¡](https://askubuntu.com/questions/387062/how-to-solve-the-phpmyadmin-not-found-issue-after-upgrading-php-and-apache)ä¸‰æ¨“çš„è§£æ³•ï¼š

![](figures/phpmyadmin-main-page-failed.png)

æ‰‹å‹•è»Ÿé€£çµåˆ° Apache2 çš„è¨­å®šè³‡æ–™å¤¾

``` {.bash .prefixed}
sudo ln -s /etc/phpmyadmin/apache.conf /etc/apache2/conf-available/phpmyadmin.conf
```

æ¥è‘—å•Ÿå‹• phpMyAdmin çš„è¨­å®šæª”

``` {.bash .prefixed}
sudo a2enconf phpmyadmin
```

é‡æ–°å•Ÿå‹• Apache2

``` {.bash .prefixed}
sudo systemctl restart apache2
```

å†å¾ç€è¦½å™¨å˜—è©¦ä¸€æ¬¡é€£ç·š

    http://<è™›æ“¬ä¸»æ©Ÿçš„ ip åœ°å€>/phpmyadmin/

æˆåŠŸï½ ğŸŠ

![](figures/phpmyadmin-main-page-successed.png)

### Step 2 --- ä½¿ phpmyadmin æ›´åŠ å®‰å…¨

é è¨­çš„ <http://host.ip/phpmyadmin> ä½å€å¯¦åœ¨æ˜¯å¤ªå±éšªäº†ï¼Œå¦‚æœæœ‰äººæœ‰æ„ç ´å£ï¼Œåˆè¢«çŒœåˆ°ç®¡ç†å“¡çš„å¯†ç¢¼ï¼Œé‚£å°‡æœƒä¸€ç™¼ä¸å¯æ”¶æ‹¾ï¼Œæ‰€ä»¥æ¥ä¸‹ä¾†è¦æ”¹çš„æ˜¯ phpMyAdmin åœ¨ Apache2 ä¸­çš„è¨­å®šï¼Œå°‡é è¨­çš„ä½ç½®æ”¹æ‰è‡³å°‘æœƒå®‰å…¨ä¸€é»ã€‚

``` {.bash .prefixed}
sudo vim /etc/phpmyadmin/apache.conf
```

::: {.infobox .info}
å› ç‚º `/etc/phpmyadmin/apache.conf` å·²è»Ÿé€£çµè‡³ `/etc/apache2/conf-available/phpmyadmin.conf` æ‰€ä»¥è®Šæ›´`apache.conf` æ™‚ï¼Œä½æ–¼ Apache2 ä¸­çš„è¨­å®šæª”ä¹Ÿæœƒè·Ÿè‘—è®Šæ›´ã€‚
:::

``` {.bash}
# phpMyAdmin default Apache configuration

Alias /sql /usr/share/phpmyadmin # è®Šæ›´é€™è£¡

<Directory /usr/share/phpmyadmin>
    Options SymLinksIfOwnerMatch
    DirectoryIndex index.php
    AllowOverride All # æ–°å¢é€™è¡Œ

    [...]

</Directory>

[...]
```

é‡æ–°å•Ÿå‹• Apache2

``` {.bash .prefixed}
sudo systemctl restart apache2
```

    http://<è™›æ“¬ä¸»æ©Ÿçš„ ip åœ°å€>/sql/

![](figures/phpmyadmin-main-page-successed.png)

### Step 3 --- å†å¤šä¸€å±¤å­˜å–çš„å¯†ç¢¼ä¿è­·ï¼ˆå¯é¸ï¼‰

æ–°å¢ä¸€å€‹å«åš `.htaccess` çš„æª”æ¡ˆ

``` {.bash .prefixed}
sudo vim /usr/share/phpmyadmin/.htaccess
```

æ”¾å…¥è¨­å®š

``` {.bash}
AuthType Basic
AuthName "é™åˆ¶å­˜å–çš„æª”æ¡ˆ"
AuthUserFile /etc/phpmyadmin/.htpasswd
Require valid-user
```

ç”¨ `htpasswd` æŒ‡ä»¤ä»¥ `.htpasswd` ç”Ÿæˆå¸³è™Ÿï¼Œé€™å€‹å¸³è™Ÿå«åš asisï¼Œæ­¤æ™‚æœƒæç¤ºä½ è¼¸å…¥å¯†ç¢¼ã€‚

``` {.bash .prefixed}
sudo htpasswd -c /etc/phpmyadmin/.htpasswd asis
```

å¦‚æœè¦æ–°å¢å…¶ä»–ä½¿ç”¨è€…ï¼Œä¸éœ€è¦åŠ ä¸Š `-c` çš„åƒæ•¸

``` {.bash .prefixed}
sudo htpasswd /etc/phpmyadmin/.htpasswd otheruser
```

å†é€²å…¥ä¸€æ¬¡ phpMyAdmin çš„ä½å€å˜—è©¦ï¼š

![](figures/htaccess-prompt-login-panel.png)

æ­¤æ™‚æœƒè·³å‡ºä¸€å€‹ç™»å…¥ä»‹é¢ï¼Œéœ€è¦è¼¸å…¥å¯†ç¢¼æ‰èƒ½é€²å…¥ phpMyAdmin çš„é é¢ã€‚ å¦‚æœä¸éœ€è¦æ­¤è¨­å®šï¼Œç›´æ¥åˆªé™¤ä½æ–¼ `/etc/phpmyadmin/.htpasswd` çš„æª”æ¡ˆå³å¯ã€‚
