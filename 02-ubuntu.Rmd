# Ubuntu çš„åŸºæœ¬è¨­å®š

<!--# TODO: https://superuser.com/questions/1200355/wsl-is-it-possible-to-access-and-manipulate-a-virtual-linux-machine-with-wsl -->

æœ¬ç« ä¸»è¦æœƒèªªæ˜å¦‚ä½•é€éé ç«¯é€£ç·šå­˜å–è™›æ“¬æ©Ÿå™¨èˆ‡è™›æ“¬æ©Ÿå™¨åŸºæœ¬è¨­å®šã€‚

## äº‹å‰æº–å‚™

å¾é€™å€‹ç« ç¯€é–‹å§‹æœƒå‡ºç¾ä¸€äº›ç‰¹æ®Šå‰ç¶´çš„æ–¹æ¡†ï¼ˆå¦‚ä¸‹è¡¨ï¼‰è¡¨ç¤ºï¼Œä¸åŒçš„å‰ç¶´ä»£è¡¨ä¸åŒç¨®é¡çš„çµ‚ç«¯æ©Ÿï¼Œæˆ–æ˜¯ä½¿ç”¨çµ‚ç«¯æ©Ÿçš„èº«ä»½ï¼Œè«‹å¤šå¤šæ³¨æ„ã€‚

-   `PS`: powershell æŒ‡ä»¤å‰ç¶´

    ``` prefixed_powershell
    dir
    ```

-   `$`: çµ‚ç«¯æ©ŸæŒ‡ä»¤å‰ç¶´ï¼ˆä¸€èˆ¬ä½¿ç”¨è€…ï¼‰

    ``` {.bash .prefixed}
    ls -al
    ```

-   `#`: çµ‚ç«¯æ©ŸæŒ‡ä»¤å‰ç¶´ï¼ˆè¶…ç´šä½¿ç”¨è€…ï¼‰

    ``` {.bash .prefixed_root}
    sudo rm -rf ~/Downloads
    ```

-   `OUTPUT`: çµ‚ç«¯æ©Ÿè¼¸å‡º

    ``` console_output
    total 12
    drwxrwxr-x  3 kuaz kuaz 4096 Sep 22 02:11 ./
    drwxr-x--- 15 kuaz kuaz 4096 Oct 10 22:30 ../
    drwxrwxr-x  6 kuaz kuaz 4096 Oct  6 14:06 School/
    ```

## OpenSSH

å‰é¢ç¬¬ä¸€ç« åœ¨å®‰è£æ™‚ï¼Œä¹Ÿæœ‰ç¢°åˆ° OpenSSH ä¼ºæœå™¨è¨­å®šçš„å°ç¯€ï¼Œä¸éé‚£ä¸¦ä¸å®Œæ•´ï¼Œæ˜¯çµ¦å·²ç¶“æ“æœ‰ ssh key pairs çš„ä½¿ç”¨è€…çœ‹çš„ã€‚åœ¨é€™å€‹å°ç¯€æœƒé€æ­¥è§£é‡‹ OpenSSH çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¾ OpenSSH å®¢æˆ¶ç«¯å®‰è£ã€ç”¢ç”Ÿ ssh key pairs æœ€å¾Œåˆ°é€£ç·šã€‚

### æ¦‚è¿°

OpenSSH æ˜¯ SSHï¼ˆSecure Shellï¼‰ä¸€å€‹é–‹æºçš„ç‰ˆæœ¬ã€‚SSH æ˜¯ä¸€ç¨®é€é SSH å‚³è¼¸å”å®šä¾†ç®¡ç†ç³»çµ±ã€å‚³è¼¸æª”æ¡ˆçš„ä¸€å€‹ç³»çµ±å¥—ä»¶ã€‚å®ƒç¾åœ¨è¢«å»£æ³›çš„ä½¿ç”¨åœ¨å„å€‹è³‡æ–™ä¸­å¿ƒèˆ‡å¤§ä¼æ¥­ä¸­ã€‚

```{r, fig.cap='SSH å‚³è¼¸å”å®šé©—è­‰æµç¨‹ åœ–ç‰‡ä¾†æºï¼šhttps://www.ssh.com/academy/ssh'}
knitr::include_graphics(path = './figures/SSH_simplified_protocol_diagram-2.png')
```

### é©åˆå„å€‹ç³»çµ±çš„é€£ç·šæµç¨‹

è¦é€£æ¥åˆ°è™›æ“¬æ©Ÿå™¨çš„ OpenSSH ä¼ºæœå™¨ä¹‹å‰ï¼Œä½ éœ€è¦æœ‰ä¸€å€‹å¯ä»¥è®“ä½ é€£æ¥çš„ OpenSSH ç”¨æˆ¶ç«¯ã€‚

#### MacOS æˆ– å…¶ä»– Unix-like ç³»çµ±

å¦‚æœä½ æ˜¯ Linux æˆ–æ˜¯ MacOS ç³»çµ±ï¼Œé€šå¸¸éƒ½æœ‰å…§å»º OpenSSH ç”¨æˆ¶ç«¯ï¼Œå¯ä»¥ç›´æ¥è·³è‡³ä»¥ [Step 2 --- ç”¢ç”Ÿ ssh key pairs] çš„ç« ç¯€ï¼Œä½†æ˜¯ Windows ç³»çµ±éœ€è¦å…ˆå®‰è£ä¸€äº›è»Ÿé«”ï¼Œæˆ–æ˜¯å¾ Windows æ›´æ–°åŠŸèƒ½è£¡é¢å•Ÿç”¨ OpenSSH ä¼ºæœå™¨èˆ‡ç”¨æˆ¶ç«¯ï¼Œå°‡æ–¼ä¸‹ä¸€å°ç¯€æœƒè§£é‡‹ã€‚

#### Windows ç³»çµ±

Windows ç”¨æˆ¶é€£ç·šè‡³ OpenSSH ä¼ºæœå™¨çš„æ–¹æ³•æœ‰å¾ˆå¤šç¨®ï¼Œæ–¹æ³•å¦‚ä¸‹:

1.  å·²ç¶“æ“æœ‰ SSH key pairs çš„å‰æä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ SSH é€šè¨Šå”å®šé€£ç·šçš„è»Ÿé«”ï¼Œå¦‚:

    -   PuTTY

    -   Chrome ç€è¦½å™¨çš„ä»»ä½•ä¸€å€‹ SSH æ“´å……å¥—ä»¶\

    **å„ªé»:**

    -   å¾ˆå¿«ï¼Œå®‰è£å®Œå°±èƒ½è¨­å®š SSH é€£ç·š

2.  ç›´æ¥åœ¨ Windows 10 å…§å•Ÿå‹• OpenSSH ç”¨æˆ¶ç«¯ï¼Œé€éå…§å»ºçš„ PowerShell SSH é€£ç·šè‡³è™›æ“¬ä¸»æ©Ÿã€‚\
    \
    **å„ªé»:**

    -   èˆ‡ç¬¬ä¸€å€‹æ–¹æ³•å·®ä¸å¤šå¿«
    -   å¯æ­é… Windows Terminal å®¢è£½åŒ–çµ‚ç«¯æ©Ÿä¸»é¡Œï¼ˆå¾ˆå¥½çœ‹ï¼‰
    -   ä¸ç”¨å®‰è£ä»»ä½•ç¬¬ä¸‰æ–¹è»Ÿé«”

3.  åœ¨ Windows 10 å…§å®‰è£ Windows å­ç³»çµ± (Windows Subsystem for Linux; WSL)ï¼Œç„¶å¾Œç›´æ¥åœ¨ Linux ç’°å¢ƒé€é OpenSSH é€£ç·šè‡³è™›æ“¬ä¸»æ©Ÿã€‚\
    \
    **å„ªé»:**

    -   å¯ä»¥å­¸ç¿’åˆ°å¾ˆå¤šæ±è¥¿ï¼Œ Linux å¯ä»¥ç”¨çš„åœ¨ Windows çš„ WSL å…§éƒ½å¯ä»¥ä½¿ç”¨ï¼Œæ“ä½œå¯ä»¥ç…§æ¬åˆ° WSL ä¸Šé¢ã€‚

    **ç¼ºé»:**

    -   å®‰è£éç¨‹æ‰€éœ€çš„æ™‚é–“æœƒæ ¹æ“šæ¯å€‹äººçš„ç¶“é©—æœ‰æ‰€å·®ç•°ï¼Œéœ€è¦å¾é ­é–‹å§‹è¨­å®š Linuxã€‚

åœ¨ Windows è¦ç”¢ç”Ÿ ssh key pairs æœ‰å…©ç¨®è¾¦æ³•ï¼Œç¬¬ä¸€ç¨®æ˜¯ç¶“ç”±å…§å»ºçš„ OpenSSH Client ç”¢ç”Ÿï¼Œå¦ä¸€ç¨®æ˜¯ç¶“ç”± PuTTY æ‰€é™„çš„å·¥å…·ç”¢ç”Ÿï¼ˆå¯ä»¥åƒè€ƒé™„éŒ„çš„ [PuTTY] ä»‹ç´¹ï¼‰ã€‚

::: {.infobox .info}
Linux çš„ä½¿ç”¨è€…å¯ä»¥ä½¿ç”¨å¥—ä»¶ç®¡ç†ç¨‹å¼å®‰è£ `openssh-server`ï¼Œ æŒ‡ä»¤å¦‚ä¸‹ï¼š

``` {.bash .prefixed}
sudo apt install openssh-server
```
:::

### Step 1 --- å®‰è£ OpenSSH Client {.unnumbered}

Windows 10 å·²ç¶“æœ‰å…§å»ºåœ¨ Windows çš„ã€Œæ‡‰ç”¨ç¨‹å¼èˆ‡åŠŸèƒ½ã€å…§ï¼Œé è¨­æ˜¯æ²’æœ‰å®‰è£çš„ã€‚å•Ÿå‹•æµç¨‹å¦‚ä¸‹:

-   é»æ“Šã€Œé–‹å§‹ã€

-   æ‰“é–‹ã€Œè¨­å®šâš™ã€

-   é¸å–ã€Œæ‡‰ç”¨ç¨‹å¼ã€ âœ ã€Œæ‡‰ç”¨ç¨‹å¼èˆ‡åŠŸèƒ½ã€ âœ æ‰¾åˆ°é»‘é«”å­—ã€Œç¨‹å¼èˆ‡åŠŸèƒ½ã€ï¼Œä¸¦é»é¸ä¸‹é¢çš„ã€Œé¸ç”¨åŠŸèƒ½ã€

-   åœ¨å·²å®‰è£çš„ç¯©é¸åˆ—ä¸Šé¢ç¯©é¸ `ssh` ï¼Œå¦‚æœæ²’æœ‰ï¼Œè«‹åœ¨é é¢é ‚ç«¯é»é¸ã€Œæ–°å¢åŠŸèƒ½ã€ï¼Œç„¶å¾Œ:

    -   æ‰¾åˆ°ã€ŒOpenSSH ç”¨æˆ¶ç«¯ã€å¾Œï¼Œé»é¸å®‰è£

å®‰è£å®Œæˆå¾Œï¼Œä½ å¯ä»¥æ‰“é–‹ã€Œå‘½ä»¤æç¤ºå­—å…ƒã€æˆ–æ˜¯ã€ŒPowerShellã€è¼¸å…¥ ssh ä¾†ç¢ºèªæ˜¯å¦å®‰è£å®Œæˆã€‚

``` {.powershell .prefixed_powershell}
ssh
```

``` console_output
usage: ssh [-46AaCfGgKkMNnqsTtVvXxYy] [-B bind_interface]
           [-b bind_address] [-c cipher_spec] [-D [bind_address:]port]
           [-E log_file] [-e escape_char] [-F configfile] [-I pkcs11]
           [-i identity_file] [-J [user@]host[:port]] [-L address]
           [-l login_name] [-m mac_spec] [-O ctl_cmd] [-o option] [-p port]
           [-Q query_option] [-R address] [-S ctl_path] [-W host:port]
           [-w local_tun[:remote_tun]] destination [command]
```

### Step 2 --- ç”¢ç”Ÿ ssh key pairs {.unnumbered}

æ¥è‘—ï¼Œå¯ä»¥ä½¿ç”¨ `ssh-keygen` æŒ‡ä»¤ç”¢ç”Ÿ key pairsï¼ŒåŠ å¯†æ–¹å¼æœ‰ dsaã€ecdsaã€ecdsa-skã€ed25519ã€ed25519-sk èˆ‡ rsaï¼Œé è¨­çš„åŠ å¯†æ–¹å¼æ˜¯ rsa ï¼Œè©³ç´°æŒ‡ä»¤ç”¨æ³•å¯ä»¥é€é `ssh-keygen --help` æŒ‡ä»¤æŸ¥è©¢ï¼Œé€™è£¡æˆ‘å€‘ç”¨æœ€ç°¡å–®çš„ `ssh-keygen` æŒ‡ä»¤ã€‚

``` {.powershell .prefixed_powershell}
ssh-keygen
```

Windows çš„ç”¨æˆ¶é è¨­æœƒæŠŠ key pair å„²å­˜åœ¨ `C:\Users\<USERNAME>\.ssh\` çš„ä½ç½®ï¼Œè€Œ Linux çš„ç”¨æˆ¶æœƒå„²å­˜åœ¨ `~/.ssh/` çš„ä½ç½®ã€‚

é€™è£¡æ˜¯è©¢å•ä½ è¦ä¸è¦æŠŠç”¢ç”Ÿçš„ ssh key é‡æ–°å‘½åï¼Œä¸€èˆ¬ä¸æœƒå‹•åˆ°å®ƒçš„åå­—ï¼ŒæŒ‰ Enterâ†©ï¼Œæ¥çºŒä¸‹ä¸€æ­¥ã€‚

``` console_output
Generating public/private rsa key pair.
Enter file in which to save the key (C:\Users\<USERNAME>/.ssh/id_rsa):
```

é€™ä¸€æ­¥å†è©¢å•ä½ éœ€ä¸éœ€è¦å°‡ SSH key pairs åŠ å¯†ï¼Œå¦‚æœåŠ å¯†äº†ï¼Œæ¯æ¬¡é€£ç·šéƒ½éœ€è¦æ‰“å¯†ç¢¼ã€‚å¦‚æœä¸æƒ³è¨­å®šå¯†ç¢¼å°±ç•™ç©ºæŒ‰ Enterâ†© é€²å…¥ä¸‹ä¸€æ­¥ã€‚

``` console_output
Created directory 'C:\Users\<USERNAME>/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
```

ç”¢ç”Ÿ Key æœƒé †å¸¶ç”¢ç”Ÿé€™å€‹ Key çš„æŒ‡ç´‹ã€‚

``` console_output
Your identification has been saved in C:\Users\<USERNAME>/.ssh/id_rsa.
Your public key has been saved in C:\Users\<USERNAME>/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:8NE76AD294Tjze76pEPtvZgqaqw9OuCF7T8HWPo6fUc qaz85@DESKTOP-OH6HA84
The key's randomart image is:
+---[RSA 3072]----+
|                 |
|         .       |
|    o . . .      |
|   . + o + .     |
|  o + o S.+      |
|.. = . =.E..     |
|..o.o ..+.=.     |
| ..+++.o.=.o.    |
|  o**++.=** ..   |
+----[SHA256]-----+
```

ç”¢ç”Ÿå®Œç•¢ï¼Œå„²å­˜åœ¨ `C:\Users\<USERNAME>\.ssh\id_rsa` çš„æª”æ¡ˆæ˜¯ç§é‘°ï¼ˆprivate keyï¼‰ï¼Œè€Œå¦ä¸€å€‹ `id_rsa.pub` çš„æª”æ¡ˆæ˜¯å…¬é‘°ï¼ˆpublic keyï¼‰ã€‚

::: {.infobox .caution}
ç•¶ä½ éºå¤±äº†é ç«¯ä¸»æ©Ÿçš„ key pairsï¼Œä½ å†ä¹Ÿä¸èƒ½é€éé ç«¯å­˜å–æœ‰ä½¿ç”¨éè©² key pairs çš„ä¸»æ©Ÿï¼Œåªèƒ½é€éç›´æ¥æ¥è§¸é‚£å°ä¸»æ©Ÿä¾†æ›´æ–°çš„ key pairsï¼Œæ‰€ä»¥è¦å¦¥å–„ä¿å­˜ã€‚
:::

### Step 3 --- å°‡æ–°å¢çš„ key pairs ä¸Šå‚³è‡³ç›®çš„åœ°ä¸»æ©Ÿ {.unnumbered}

ç•¶ä½ æ“æœ‰äº† [Step 2 --- ç”¢ç”Ÿ ssh key pairs]ï¼Œæ¥ä¸‹ä¾†è¦æŠŠ public key ä¸Šå‚³è‡³è™›æ“¬æ©Ÿå™¨ã€‚å¦å¤–å…¬é‘°çµ¦åˆ¥äººçœ‹åˆ°æ˜¯æ²’å•é¡Œçš„ï¼Œå‰é¢ç¬¬ä¸€ç« çš„ [OpenSSH è¨­å®š [å¯è·³é]] å°±å·²ç¶“æœ‰å‡ºç¾éæˆ‘çš„å…¬é‘°äº†ï¼Œå…¬é‘°ä¸¦ä¸èƒ½ç”¨ä¾†ç”¢ç”Ÿç§é‘°ï¼Œå®ƒæ˜¯ç”¨ä¾†èªè­‰é€™å€‹ key æ˜¯å¦è·Ÿä½ æ‰€æŒæœ‰çš„ç§é‘°ç›¸å‘¼æ‡‰ã€‚

#### Linux ç³»çµ±

å¦‚æœä½ æ˜¯çš„ç³»çµ±æ˜¯ Linux é‚£æŒ‡ä»¤æœƒç¨å¾®çŸ­ä¸€äº›ï¼Œä¸Šå‚³è‡³é ç«¯é›»è…¦çš„æŒ‡ä»¤å¦‚ä¸‹:

``` {.bash .prefixed}
ssh-copy-id -i ~/.ssh/id_ed25519.pub -p 22 asis@192.168.0.13
```

-   `-i`: i flag ä»£è¡¨çš„æ˜¯ä½ è¦ä¸Šå‚³çš„ public key æª”æ¡ˆè·¯å¾‘

-   `-p`: p flag å‰‡æ˜¯ç›®çš„åœ°ä¸»æ©Ÿçš„ OpenSSH ä¼ºæœå™¨çš„åŸ è™Ÿ

-   `id_ed25519.pub` ç‚ºæˆ‘ç”¢ç”Ÿçš„å…¶ä»–çš„ key pairï¼Œå¦‚æœä½ å‰é¢æ˜¯ç…§è‘—æˆ‘çš„æ­¥é©Ÿç”¢ç”Ÿï¼Œé€™è£¡æ‡‰è©²æ”¹ç‚º `id_rsa.pub`

-   é€™è£¡çš„ `asis` ç‚ºç¬¬ä¸€ç«  [ä½¿ç”¨è€…è¨­å®š] çš„é è¨­ä½¿ç”¨è€…

-   `192.168.0.13` ç‚ºæˆ‘è™›æ“¬ä¸»æ©Ÿçš„ ip ä½å€ï¼ŒæŸ¥è©¢ ip ä½å€å¯ä»¥å…ˆæ‰‹å‹•ç™»å…¥è™›æ“¬ä¸»æ©Ÿå¾Œï¼Œç”¨ `hostname -I` æˆ–æ˜¯ `ip addr show` æŒ‡ä»¤æŸ¥è©¢

å®Œæˆå¾Œæœƒæç¤ºä½ å·²ç¶“å¯ä»¥ä½¿ç”¨ ssh é€£ç·š

``` console_output
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/kuaz/.ssh/id_ed25519.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh -p '22' 'asis@192.168.0.13'"
and check to make sure that only the key(s) you wanted were added.
```

å¦‚æœä½ æ˜¯ Windows çš„ä½¿ç”¨è€…ä¹Ÿä¸ç”¨æ“”å¿ƒå¤šè¤‡é›œï¼Œä¸€æ¨£ä¸€è¡ŒæŒ‡ä»¤å°±èƒ½æå®šï¼Œé€™è£¡æˆ‘æ˜¯åƒè€ƒ[@christopher_2020]çš„æ•™å­¸ï¼ŒæŒ‡ä»¤å¦‚ä¸‹:

``` {.powershell .prefixed_powershell}
cat $env:USERPROFILE\.ssh\id_rsa.pub | ssh asis@192.168.0.13 "cat >> ~/.ssh/authorized_keys"
```

-   é€™è£¡çš„ `$env:USERPROFILE` ç‚º Windows å…§å»ºç’°å¢ƒè®Šæ•¸ï¼Œæœƒæ ¹æ“šç¾åœ¨çš„ä½¿ç”¨è€…è®Šæ›´ï¼Œå¦‚æœæˆ‘çš„ä½¿ç”¨è€…åç¨±ç‚º `qaz855175b` é‚£ `$env:USERPROFILE` å°æ‡‰çš„è·¯å¾‘å°±ç‚º `C:\Users\qaz855175b\`ï¼Œç•¶ç„¶ä½ å¯ä»¥ç›´æ¥æŠŠæŒ‡ä»¤çš„ public key è·¯å¾‘æ›¿æ›ç‚º `C:\Users\qaz855175b\.ssh\id_rsa.pub`

-   `id_rsa.pub` ç‚ºç”¢ç”Ÿçš„ public key é è¨­åç¨±

-   é€™è£¡çš„ `asis` ç‚ºç¬¬ä¸€ç«  [ä½¿ç”¨è€…è¨­å®š] çš„é è¨­ä½¿ç”¨è€…

-   `192.168.0.13` ç‚ºæˆ‘è™›æ“¬ä¸»æ©Ÿçš„ ip ä½å€ï¼ŒæŸ¥è©¢ ip ä½å€å¯ä»¥å…ˆæ‰‹å‹•ç™»å…¥è™›æ“¬ä¸»æ©Ÿå¾Œï¼Œç”¨ `hostname -I` æˆ–æ˜¯ `ip addr show` æŒ‡ä»¤æŸ¥è©¢

::: {.infobox .info}
å…¶å¯¦ Linux çš„ `ssh-copy-id`ã€å’Œç¬¬ä¸€ç« çš„å¾ Github åŒ¯å…¥ public key `ssh-import-id-gh` èˆ‡é€™è£¡çš„ `cat file >> ~/.ssh/authorized_keys` éƒ½æ˜¯åœ¨åšåŒä¸€ä»¶äº‹æƒ…ï¼ŒæŠŠ public key è²¼åˆ°é ç«¯ä¼ºæœå™¨çš„ä½¿ç”¨è€…çš„ `authorized_keys` æª”æ¡ˆè£¡é¢ã€‚
:::

æ¥è‘—æŒ‰ Enterâ†©ï¼Œè·³å‡ºè¼¸å…¥å¯†ç¢¼æç¤ºï¼Œé€™è£¡è¼¸å…¥é è¨­çš„ä½¿ç”¨è€…å¯†ç¢¼ `asis`

``` console_output
asis@192.168.0.13's password:
```

è¼¸å…¥å®Œå¾Œé›–ç„¶æ²’æœ‰ä»»ä½•æç¤ºè¨Šæ¯ï¼Œä½†å…¶å¯¦å·²ç¶“å¯ä»¥ä½¿ç”¨ ssh é€£ç·šè‡³é ç«¯ä¸»æ©Ÿå•¦ï½

### Step 4 --- æ¸¬è©¦ SSH é€£ç·šï¼Œä½¿ç”¨ SSH é€£ç·šè‡³é ç«¯ä¸»æ©Ÿ {.unnumbered}

æœ€å¾Œï¼Œä½¿ç”¨ ssh æŒ‡ä»¤é€£æ¥è‡³é ç«¯ä¸»æ©Ÿã€‚

ä½¿ç”¨ OpenSSH Client ç”¢ç”Ÿçš„ pair keys å¯ä»¥ç›´æ¥ä½¿ç”¨é€™å€‹æ–¹æ³•é€£ç·šã€‚é€™è£¡ä»‹ç´¹å¹¾å€‹å¸¸å¸¸èˆ‡ ssh ä¸€èµ·å‡ºç¾çš„ flag :

-   `-v`: verboseï¼Œé¡¯ç¤ºé€£æ¥æ™‚æ›´è©³ç´°çš„è¨Šæ¯ï¼Œé™¤éŒ¯æ™‚å¸¸ç”¨

-   `-p`: port;ï¼Œé ç«¯ä¼ºæœå™¨çš„åŸ è™Ÿ

-   `-i`: æ‰‹å‹•æŒ‡å®šç§é‘°ä½ç½®

::: {.infobox .info}
flag é€šå¸¸æœƒåœ¨æŒ‡ä»¤å¾Œé¢éš¨å¾Œå‡ºç¾ï¼Œflagå‰é¢æœƒæ’å…¥ `-`ï¼Œè€Œ flag å¾Œé¢æœ‰æ™‚æœƒéœ€è¦åŠ å…¥è©³ç´°çš„è¨­å®šï¼Œæœ‰æ™‚ä¸ç”¨ã€‚flag èˆ‡ flag ä¹‹é–“ç”¨ç©ºæ ¼éš”é–‹ï¼Œè©³ç´°æŒ‡ä»¤çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥åœ¨ Linux ç³»çµ±ç”¨ `man <æŒ‡ä»¤åç¨±>` æŸ¥è©¢

å‡å¦‚æˆ‘å€‘è¦çœ‹é€£ç·šçš„è©³ç´°è¨Šæ¯ï¼Œä¸”æŒ‡å®šä¼ºæœå™¨ port ç‚º 60000èˆ‡æŒ‡å®š private key æª”æ¡ˆä½å€ç­‰ç­‰ï¼Œçµ„åˆèµ·ä¾†å°±æ˜¯:

``` bash
ssh -v -p 60000 -i ~/.ssh/id_rsa asis@192.168.0.13
```
:::

ç›®å‰ä¸éœ€è¦åŠ ä¸Šä»»ä½• flagï¼Œé€£ç·šæŒ‡ä»¤ç‚ºï¼š

``` {.bash .prefixed_powershell}
ssh asis@192.168.0.13
```

ä¸€æ¨£åœ°ï¼Œ`asis` æ˜¯ä½¿ç”¨è€…åç¨±ï¼Œè€Œ`192.168.0.13` æ˜¯ OpenSSH ä¼ºæœå™¨çš„ ip ä½ç½®ï¼Œè¼¸å…¥å®Œå¾ŒæŒ‰ Enterâ†©ã€‚

é€™é‚Šæ‰“ `yes` å³å¯ï¼Œç¢ºèªé€£æ¥ç›®çš„åœ°æ²’æœ‰éŒ¯ä¹‹å¾Œï¼ŒæœƒæŠŠ fingerprint å¯«å…¥ `~/.ssh/known_hosts` ä¸­ï¼Œä»¥å¾Œä¸å†è©¢å•ã€‚

``` console_output
The authenticity of host '192.168.0.13 (192.168.0.13)' can't be established.
ECDSA key fingerprint is SHA256:/HoocrLXe63zycdlmkh/+U3RuUfkawNq/xA0gTJmqmM.
Are you sure you want to continue connecting (yes/no/[fingerprint])?
```

::: {.infobox .info}
é€™è£¡ä¸ç”¨æŒ‡å®š private key çš„åŸå› æ˜¯å› ç‚ºï¼Œç•¶ä½ ç”¨ ssh é€£ç·šè‡³ç›®çš„åœ°ä¼ºæœå™¨ä¸”ä½ æ²’æœ‰æŒ‡å®šèªè­‰æª”æ¡ˆï¼ˆç§é‘°ï¼‰æ™‚ï¼Œ`ssh` æœƒä¸€å€‹ key ä¸€å€‹ key æ‹¿å»å•ä¼ºæœå™¨é€™å€‹ key å¯ä¸å¯ä»¥ä½¿ç”¨ã€‚
:::

é€£æ¥æˆåŠŸ!

![](figures/ssh-connection-success.png){.figure}

æ¸¬è©¦å®Œç¢ºèªæ²’å•é¡Œå°±å¯ä»¥æŠŠè™›æ“¬æ©Ÿæ™¾åœ¨ä¸€æ—äº†ï½

![](figures/virtualbox-ubuntu-login.png){.figure}

### Step 5 --- ä½¿é ç«¯çš„ OpenSSH ä¼ºæœå™¨æ›´åŠ å®‰å…¨ [å¯è·³é] {.unnumbered}

#### è®Šæ›´ SSH ä¼ºæœå™¨é è¨­çš„åŸ è™Ÿ {.unnumbered}

``` {.bash .prefixed}
sudo vim /etc/ssh/sshd_config
```

å°‡ `#Port 22` å–æ¶ˆè¨»è§£ï¼Œä¸¦æŠŠ `22` æ”¹æˆå…¶ä»–ä»‹æ–¼ 1-65535 ä¹‹é–“çš„æ•¸å­—ã€‚

``` bash
#       $OpenBSD: sshd_config,v 1.103 2018/04/09 20:41:22 tj Exp $

# This is the sshd server system-wide configuration file.  See 
# sshd_config(5) for more information.

# This sshd was compiled with PATH=/usr/bin:/bin:/usr/sbin:/sbin

# The strategy used for options in the default sshd_config shipped with
# OpenSSH is to specify options with their default value where
# possible, but leave them commented.  Uncommented options override the
# default value.

Include /etc/ssh/sshd_config.d/*.conf

Port 60000
#AddressFamily any
#ListenAddress 0.0.0.0
#ListenAddress ::
```

#### é—œé–‰å¯†ç¢¼é©—è­‰ {.unnumbered}

å°‡ PasswordAuthenticationï¼ˆä»¥å¯†ç¢¼é©—è­‰ï¼‰è¨­ç‚º noã€‚ä½¿ç”¨ SSH é€£ç·šæ™‚ï¼Œå¦‚æœæ²’æœ‰æŒ‡å®š SSH key pairï¼Œå¦‚æœ OpenSSH ä¼ºæœå™¨çš„è¨­å®šæ²’æœ‰é—œé–‰ï¼Œæ¥è‘—æœƒè¦æ±‚ä½ è¼¸å…¥ä½¿ç”¨è€…å¯†ç¢¼ä»¥å¯†ç¢¼é©—è­‰ã€‚é€šå¸¸é€™å€‹è¨­å®šæœƒé–‹å•Ÿæ˜¯å› ç‚ºè¦[Step 3 --- å°‡æ–°å¢çš„ key pairs ä¸Šå‚³è‡³ç›®çš„åœ°ä¸»æ©Ÿ]ã€‚

``` bash
PasswordAuthentication no
```

ç•¶ç„¶å¦‚æœå¯†ç¢¼é©—è­‰ç‚º noï¼Œä¸”åŒæ™‚éºå¤± SSH çš„ pair key æ™‚ï¼Œä½ å°±ç„¡æ³•ä»¥ SSH é€£ç·šè‡³é ç«¯ä¸»æ©Ÿï¼Œéœ€è¦å¯¦éš›çš„ä½¿ç”¨åœ–å½¢ä»‹é¢æ“ä½œè™›æ“¬æ©Ÿå™¨ã€‚

#### é—œé–‰é ç«¯ root ç™»å…¥ {.unnumbered}

é¿å… root ç™»å…¥å¯ä»¥ä½¿ç³»çµ±é¿å…éå¤§çš„æ¬Šé™æš´éœ²ã€‚

``` bash
PermitRootLogin no
```

#### é™åˆ¶èƒ½ä½¿ç”¨ SSH é€£ç·šçš„ä½¿ç”¨è€… {.unnumbered}

åªå…è¨±ç‰¹å®šçš„ä½¿ç”¨è€…ä½¿ç”¨ SSH é€£ç·šå¯å¤§å¤§é™ä½é¢¨éšªã€‚

``` bash
AllowUsers asis
```

#### é—œé–‰ç„¡å¯†ç¢¼çš„ä½¿ç”¨è€…ä½¿ç”¨ SSH {.unnumbered}

å°‡æ²’æœ‰å¯†ç¢¼å°±å¯ä»¥ç™»å…¥çš„ä½¿ç”¨è€…æ’¤éŠ· SSH é€£ç·šçš„æ¬Šé™ã€‚

``` bash
PermitEmptyPasswords no
```

### Step 6 --- æ¸¬è©¦ `sshd_config` æ˜¯å¦æœ‰æ•ˆ

`-t` æ——æ¨™å¯ä»¥æ¸¬è©¦ SSH çš„è¨­å®šæ˜¯å¦æœ‰æ•ˆï¼Œå¯ä»¥é¿å…ä¸€äº›éŒ¯å­—é€ æˆçš„éŒ¯èª¤ã€‚

``` {.bash .prefixed}
sudo sshd -t
```

å°‡ç³»çµ±ä¸Šçš„ SSH daemon é‡æ–°å•Ÿå‹•ï¼Œé‡æ–°å•Ÿå‹• SSH æœå‹™ã€‚

``` {.bash .prefixed}
sudo systemctl restart sshd
```

ç¢ºèª SSH æœå‹™æ­£å¸¸é‹è¡Œï¼Œæ²’æœ‰å‡ºç¾éŒ¯èª¤ã€‚

``` {.bash .prefixed}
sudo systemctl status sshd
```

``` console_output
â— ssh.service - OpenBSD Secure Shell server
     Loaded: loaded (/lib/systemd/system/ssh.service; enabled; vendor preset: enabled)
     Active: active (running) since Sun 2021-08-15 16:08:55 UTC; 19h ago
       Docs: man:sshd(8)
             man:sshd_config(5)
    Process: 850 ExecStartPre=/usr/sbin/sshd -t (code=exited, status=0/SUCCESS)
   Main PID: 893 (sshd)
      Tasks: 1 (limit: 4617)
     Memory: 5.4M
     CGroup: /system.slice/ssh.service
             â””â”€893 sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups

Aug 15 16:08:54 asis01 systemd[1]: Starting OpenBSD Secure Shell server...
Aug 15 16:08:55 asis01 sshd[893]: Server listening on 0.0.0.0 port 60000.
Aug 15 16:08:55 asis01 sshd[893]: Server listening on :: port 60000.
Aug 15 16:08:55 asis01 systemd[1]: Started OpenBSD Secure Shell server.
```

æœ€å¾ŒæŒ‡ä»¤ `exit` æ–·é–‹é€£ç·šï¼Œå†é‡æ–°æ¸¬è©¦ ssh é ç«¯é€£ç·šè‡³ä¼ºæœå™¨ï¼Œä½¿ç”¨å…¬é‘°èˆ‡ç§é‘°é©—è­‰ç™»å…¥ã€‚

``` {.bash .prefixed_powershell}
ssh -p 60000 asis@192.168.0.13
```

``` console_output
Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-81-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Mon 16 Aug 2021 12:32:20 PM UTC

  System load:             0.0
  Usage of /:              0.7% of 974.32GB
  Memory usage:            5%
  Swap usage:              0%
  Processes:               124
  Users logged in:         0
  IPv4 address for enp0s3: 192.168.0.13
  IPv6 address for enp0s3: fd00:1cab:c0bb:acc2:a00:27ff:fed3:8136

 * Super-optimized for small spaces - read how we shrank the memory
   footprint of MicroK8s to make it the smallest full K8s around.

   https://ubuntu.com/blog/microk8s-memory-optimisation

0 updates can be applied immediately.


Last login: Mon Aug 16 12:31:35 2021 from 192.168.0.11
```

é€£ç·šæˆåŠŸï½ğŸ–¼

## APT

åœ¨ Ubuntu ä¸Šå®‰è£ä»»ä½•ç¨‹å¼å¤§å¤šéƒ½æ˜¯ç”¨ APT (Advanced Packaging Tools) å®‰è£ï¼Œé€™è£¡æœ‰å…©å€‹æŒ‡ä»¤ï¼Œç”¨ `&&` ä¸²æ¥åœ¨ä¸€èµ·:

``` {.bash .prefixed}
sudo apt update && sudo apt upgrade -y
```

-   `apt update`: æ›´æ–°å¯å®‰è£çš„å¥—ä»¶åˆ—è¡¨æˆ–ç‰ˆæœ¬

-   `apt upgrade`: å®‰è£ç¨‹å¼

-   `&&`: `&&` ä¹‹å‰çš„æŒ‡ä»¤åŸ·è¡ŒæˆåŠŸæ‰æœƒæ¥çºŒåŸ·è¡Œ `&&` å¾Œé¢çš„æŒ‡ä»¤

-   `-y, --yes, --assume-yes`: è‡ªå‹•å°å®‰è£æç¤ºå›ç­” yesï¼Œå®‰è£æ™‚æœƒæç¤ºæ˜¯å¦ç¢ºèªè¦å®‰è£è©²è»Ÿé«”ï¼Œå› ç‚ºæˆ‘å€‘æ¸…æ¥šè‡ªå·±åœ¨åšä»€éº¼ç‚ºäº†æ–¹ä¾¿è€ŒæŠŠæç¤ºé—œæ‰

## UFW

UFWï¼ˆUncomplicated Firewallï¼‰æ˜¯é è¨­åœ¨ Ubuntu ç³»çµ±ä¸Šçš„é˜²ç«ç‰†ï¼Œé€™è£¡å…ˆç‚ºäº† OpenSSH ä¼ºæœå™¨è€Œæ‰“é–‹åŸ è™Ÿ `60000`ã€‚

é¦–å…ˆç”¨ status æŸ¥è©¢ UFW çš„ç‹€æ…‹ï¼Œé€™è£¡éœ€è¦è¼¸å…¥è¶…ç´šä½¿ç”¨è€… (sudo) çš„å¯†ç¢¼ã€‚

``` {.bash .prefixed}
sudo ufw status
```

çœ‹ä¾†é è¨­çš„ UFW æ˜¯é—œé–‰çš„

``` console_output
Status: inactive
```

æ¥è‘—ç”¨ `systemctl` æ‰“é–‹é˜²ç«ç‰†

``` {.bash .prefixed}
sudo systemctl enable ufw
```

æŸ¥è©¢é˜²ç«ç‰†ç‹€æ…‹

``` {.bash .prefixed}
sudo ufw status
```

``` console_output
Status: active
```

å…è¨±åŸ è™Ÿ `60000` å¾ä»»ä½•åœ°æ–¹é€£å…¥

``` {.bash .prefixed}
sudo ufw allow 60000
```

æŸ¥è©¢é˜²ç«ç‰†ç‹€æ…‹

``` {.bash .prefixed}
sudo ufw status
```

ç›®å‰åªæœ‰å…©æ¢è¦å‰‡ï¼Œåˆ†åˆ¥æ˜¯ å¾ä»»ä½•åœ°æ–¹é€£å…¥åŸ è™Ÿ 60000 èˆ‡ ipv6 å¾ä»»ä½•åœ°æ–¹é€£å…¥åŸ è™Ÿ 60000

``` console_output
Status: active

To                         Action      From
--                         ------      ----
60000                      ALLOW       Anywhere
60000 (v6)                 ALLOW       Anywhere (v6)
```
